<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Enhanced Document Tree View -->
        <record id="view_internship_document_tree" model="ir.ui.view">
            <field name="name">internship.document.tree</field>
            <field name="model">internship.document</field>
            <field name="arch" type="xml">
                <tree string="Documents" 
                      create="true" 
                      editable="false" 
                      multi_edit="1"
                      decoration-info="review_status == 'pending'"
                      decoration-warning="review_status == 'under_review'"
                      decoration-success="review_status == 'approved'"
                      decoration-danger="review_status == 'rejected'"
                      decoration-primary="is_latest_version">
                    <!-- Document Information -->
                    <field name="name"/>
                    <field name="document_type" widget="badge"/>
                    <field name="version_number" widget="numeric"/>
                    <field name="file_size" widget="numeric"/>
                    <field name="mime_type"/>
                    
                    <!-- Related Records -->
                    <field name="internship_id"/>
                    <field name="student_id"/>
                    <field name="supervisor_id"/>
                    <field name="uploaded_by"/>

                    <!-- Review Information -->
                    <field name="review_status" widget="badge"/>
                    <field name="reviewer_id"/>
                    <field name="review_date"/>
                    <field name="rejection_reason"/>

                    <!-- Access & Security -->
                    <field name="access_level" widget="badge"/>
                    <field name="is_locked" widget="boolean_toggle"/>
                    <field name="locked_by"/>
                    <field name="locked_date"/>

                    <!-- Statistics -->
                    <field name="download_count" widget="numeric"/>
                    <field name="is_latest_version" widget="boolean_toggle"/>
                    <field name="checksum"/>

                    <!-- Status -->
                    <field name="active" widget="boolean_toggle"/>
                    <field name="create_date"/>
                    <field name="write_date"/>
                </tree>
            </field>
        </record>

        <!-- Document Kanban View -->
        <record id="view_internship_document_kanban" model="ir.ui.view">
            <field name="name">internship.document.kanban</field>
            <field name="model">internship.document</field>
            <field name="arch" type="xml">
                <kanban default_group_by="document_type" class="o_kanban_small_column">
                    <field name="id"/>
                    <field name="name"/>
                    <field name="document_type"/>
                    <field name="review_status"/>
                    <field name="file_size"/>
                    <field name="mime_type"/>
                    <field name="version_number"/>
                    <field name="is_latest_version"/>
                    <field name="student_id"/>
                    <field name="supervisor_id"/>
                    <field name="download_count"/>
                    <field name="create_date"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="#{kanban_color(record.review_status.raw_value)} oe_kanban_global_click">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                        </strong>
                                    </div>
                                    <div class="o_kanban_manage_button_section">
                                        <a class="o_kanban_manage_toggle_button" href="#">
                                            <i class="fa fa-ellipsis-v" role="img" aria-label="Manage" title="Manage"/>
                                        </a>
                                    </div>
                                </div>
                                <div class="o_kanban_record_body">
                                    <div class="row">
                                        <div class="col-6">
                                            <span class="badge badge-pill" t-attf-style="background-color: #{record.document_type.raw_value == 'convention' ? '#875A7B' : record.document_type.raw_value == 'report' ? '#28a745' : '#6c757d'};">
                                                <field name="document_type"/>
                                            </span>
                                        </div>
                                        <div class="col-6">
                                            <span class="badge badge-pill" t-attf-style="background-color: #{record.review_status.raw_value == 'approved' ? '#28a745' : record.review_status.raw_value == 'rejected' ? '#dc3545' : '#ffc107'};">
                                                <field name="review_status"/>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col-12">
                                            <i class="fa fa-user"/> <field name="student_id"/>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <i class="fa fa-user-tie"/> <field name="supervisor_id"/>
                                        </div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col-6">
                                            <i class="fa fa-file"/> v<field name="version_number"/>
                                        </div>
                                        <div class="col-6">
                                            <i class="fa fa-download"/> <field name="download_count"/>
                                        </div>
                                    </div>
                                    <div class="row" t-if="record.file_size.raw_value > 0">
                                        <div class="col-12">
                                            <small class="text-muted">
                                                <i class="fa fa-hdd-o"/> <t t-esc="Math.round(record.file_size.raw_value / 1024)"/> KB
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <span t-if="record.is_latest_version.raw_value" class="badge badge-success">Latest</span>
                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <field name="create_date" widget="date"/>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Document Search View -->
        <record id="view_internship_document_search" model="ir.ui.view">
            <field name="name">internship.document.search</field>
            <field name="model">internship.document</field>
            <field name="arch" type="xml">
                <search string="Search Documents">
                    <!-- Search Fields -->
                    <field name="name"/>
                    <field name="student_id"/>
                    <field name="supervisor_id"/>
                    <field name="internship_id"/>
                    <field name="uploaded_by"/>

                    <!-- Status Filters -->
                    <filter string="My Documents" name="my_documents"
                            domain="['|', ('student_id.user_id', '=', uid), ('uploaded_by', '=', uid)]"/>
                    <filter string="To Review" name="to_review"
                            domain="[('supervisor_id.user_id', '=', uid), ('review_status', 'in', ['pending', 'under_review'])]"/>
                    <filter string="Latest Versions" name="latest_versions"
                            domain="[('is_latest_version', '=', True)]"/>
                    <filter string="Locked Documents" name="locked"
                            domain="[('is_locked', '=', True)]"/>

                    <!-- Review Status Filters -->
                    <separator/>
                    <filter string="Draft" name="draft" domain="[('review_status', '=', 'draft')]"/>
                    <filter string="Pending Review" name="pending_review" domain="[('review_status', '=', 'pending')]"/>
                    <filter string="Under Review" name="under_review" domain="[('review_status', '=', 'under_review')]"/>
                    <filter string="Approved" name="approved" domain="[('review_status', '=', 'approved')]"/>
                    <filter string="Rejected" name="rejected" domain="[('review_status', '=', 'rejected')]"/>

                    <!-- Document Type Filters -->
                    <separator/>
                    <filter string="Convention" name="convention" domain="[('document_type', '=', 'convention')]"/>
                    <filter string="Report" name="report" domain="[('document_type', '=', 'report')]"/>
                    <filter string="Presentation" name="presentation" domain="[('document_type', '=', 'presentation')]"/>
                    <filter string="Attestation" name="attestation" domain="[('document_type', '=', 'attestation')]"/>
                    <filter string="Evaluation Report" name="evaluation_report" domain="[('document_type', '=', 'evaluation_report')]"/>
                    <filter string="CV/Resume" name="cv_resume" domain="[('document_type', '=', 'cv_resume')]"/>
                    <filter string="Transcript" name="transcript" domain="[('document_type', '=', 'transcript')]"/>
                    <filter string="Cover Letter" name="cover_letter" domain="[('document_type', '=', 'cover_letter')]"/>
                    <filter string="Certificate" name="certificate" domain="[('document_type', '=', 'certificate')]"/>
                    <filter string="Project" name="project" domain="[('document_type', '=', 'project')]"/>
                    <filter string="Other" name="other" domain="[('document_type', '=', 'other')]"/>

                    <!-- Access Level Filters -->
                    <separator/>
                    <filter string="Public" name="public" domain="[('access_level', '=', 'public')]"/>
                    <filter string="Internal" name="internal" domain="[('access_level', '=', 'internal')]"/>
                    <filter string="Confidential" name="confidential" domain="[('access_level', '=', 'confidential')]"/>
                    <filter string="Restricted" name="restricted" domain="[('access_level', '=', 'restricted')]"/>

                    <!-- File Size Filters -->
                    <separator/>
                    <filter string="Small Files (&lt; 1MB)" name="small_files" domain="[('file_size', '&lt;', 1048576)]"/>
                    <filter string="Medium Files (1-10MB)" name="medium_files" domain="[('file_size', '&gt;=', 1048576), ('file_size', '&lt;', 10485760)]"/>
                    <filter string="Large Files (&gt; 10MB)" name="large_files" domain="[('file_size', '&gt;=', 10485760)]"/>

                    <!-- Date Filters -->
                    <separator/>
                    <filter string="Uploaded Today" name="uploaded_today" domain="[('create_date', '&gt;=', context_today())]"/>
                    <filter string="Uploaded This Week" name="uploaded_this_week" domain="[('create_date', '&gt;=', (context_today() - datetime.timedelta(days=7)))]"/>
                    <filter string="Uploaded This Month" name="uploaded_this_month" domain="[('create_date', '&gt;=', (context_today() - datetime.timedelta(days=30)))]"/>

                    <!-- Group By -->
                    <group expand="0" string="Group By">
                        <filter string="Document Type" name="group_document_type" context="{'group_by': 'document_type'}"/>
                        <filter string="Review Status" name="group_review_status" context="{'group_by': 'review_status'}"/>
                        <filter string="Access Level" name="group_access_level" context="{'group_by': 'access_level'}"/>
                        <filter string="Internship" name="group_internship" context="{'group_by': 'internship_id'}"/>
                        <filter string="Student" name="group_student" context="{'group_by': 'student_id'}"/>
                        <filter string="Supervisor" name="group_supervisor" context="{'group_by': 'supervisor_id'}"/>
                        <filter string="Uploaded By" name="group_uploaded_by" context="{'group_by': 'uploaded_by'}"/>
                        <filter string="Reviewer" name="group_reviewer" context="{'group_by': 'reviewer_id'}"/>
                        <filter string="MIME Type" name="group_mime_type" context="{'group_by': 'mime_type'}"/>
                        <filter string="Upload Date" name="group_create_date" context="{'group_by': 'create_date:month'}"/>
                        <filter string="Review Date" name="group_review_date" context="{'group_by': 'review_date:month'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Enhanced Document Form View -->
        <record id="view_internship_document_form" model="ir.ui.view">
            <field name="name">internship.document.form</field>
            <field name="model">internship.document</field>
            <field name="arch" type="xml">
                <form string="Document">
                    <header>
                        <button name="action_submit_for_review" string="Submit for Review" type="object"
                                class="oe_highlight" icon="fa-send"
                                help="Submit document for review"
                                attrs="{'invisible': [('review_status', '!=', 'draft')]}"/>
                        <button name="action_approve_document" string="Approve" type="object"
                                class="btn-success" icon="fa-check"
                                help="Approve document"
                                attrs="{'invisible': [('review_status', 'not in', ['pending', 'under_review'])]}"
                                groups="internship_management.group_internship_supervisor"/>
                        <button name="action_reject_document" string="Reject" type="object"
                                class="btn-danger" icon="fa-times"
                                help="Reject document"
                                attrs="{'invisible': [('review_status', 'not in', ['pending', 'under_review'])]}"
                                groups="internship_management.group_internship_supervisor"/>
                        <button name="action_lock_document" string="Lock" type="object"
                                icon="fa-lock"
                                help="Lock document to prevent modifications"
                                attrs="{'invisible': [('is_locked', '=', True)]}"/>
                        <button name="action_unlock_document" string="Unlock" type="object"
                                icon="fa-unlock"
                                help="Unlock document to allow modifications"
                                attrs="{'invisible': [('is_locked', '=', False)]}"
                                groups="internship_management.group_internship_manager"/>
                        <button name="action_download" string="Download" type="object"
                                icon="fa-download"
                                help="Download document"/>
                        <field name="review_status" widget="statusbar" statusbar_visible="draft,pending,under_review,approved"/>
                    </header>

                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <!-- Smart buttons -->
                            <button class="oe_stat_button" type="object" name="action_view_versions" icon="fa-history">
                                <field string="Versions" name="version_count" widget="statinfo"/>
                            </button>

                            <button class="oe_stat_button" type="object" name="action_view_downloads" icon="fa-download">
                                <field string="Downloads" name="download_count" widget="statinfo"/>
                            </button>

                            <div class="oe_stat_button" t-if="record.is_latest_version.raw_value">
                                <div class="o_field_widget o_stat_info">
                                    <span class="o_stat_text">Latest Version</span>
                                </div>
                            </div>

                            <div class="oe_stat_button" t-if="record.is_locked.raw_value">
                                <div class="o_field_widget o_stat_info">
                                    <span class="o_stat_text">Locked</span>
                                </div>
                            </div>
                        </div>

                        <!-- Title and Basic Info -->
                        <div class="oe_title">
                            <label for="name"/>
                            <h1><field name="name" placeholder="Document name..."/></h1>
                        </div>

                        <!-- Main Information -->
                        <group>
                            <group name="document_info" string="Document Information">
                                <field name="document_type"/>
                                <field name="file_attachment" filename="name"/>
                                <field name="access_level"/>
                                <field name="version_number" readonly="1"/>
                                <field name="is_latest_version" readonly="1"/>
                            </group>
                            <group name="related_records" string="Related Records">
                                <field name="internship_id"/>
                                <field name="student_id"/>
                                <field name="supervisor_id"/>
                                <field name="uploaded_by" readonly="1"/>
                            </group>
                        </group>

                        <!-- File Information -->
                        <group>
                            <group name="file_info" string="File Information">
                                <field name="file_size" readonly="1" widget="numeric"/>
                                <field name="mime_type" readonly="1"/>
                                <field name="checksum" readonly="1"/>
                            </group>
                            <group name="security" string="Security &amp; Access">
                                <field name="is_locked" readonly="1"/>
                                <field name="locked_by" readonly="1" attrs="{'invisible': [('is_locked', '=', False)]}"/>
                                <field name="locked_date" readonly="1" attrs="{'invisible': [('is_locked', '=', False)]}"/>
                            </group>
                        </group>

                        <!-- Review Information -->
                        <group name="review_info" string="Review Information" attrs="{'invisible': [('review_status', '=', 'draft')]}">
                            <group>
                                <field name="reviewer_id" readonly="1"/>
                                <field name="review_date" readonly="1"/>
                                <field name="review_comments" readonly="1"/>
                            </group>
                            <group>
                                <field name="rejection_reason" readonly="1" attrs="{'invisible': [('review_status', '!=', 'rejected')]}"/>
                                <field name="approval_date" readonly="1" attrs="{'invisible': [('review_status', '!=', 'approved')]}"/>
                            </group>
                        </group>

                        <!-- Additional Information -->
                        <notebook>
                            <page name="description" string="Description &amp; Notes">
                                <group>
                                    <field name="description" nolabel="1" placeholder="Document description..."/>
                                </group>
                                <separator string="Internal Notes"/>
                                <field name="notes" nolabel="1" placeholder="Internal notes and comments..."/>
                            </page>

                            <page name="versions" string="Version History">
                                <field name="version_ids" nolabel="1" readonly="1">
                                    <tree>
                                        <field name="version_number"/>
                                        <field name="name"/>
                                        <field name="create_date"/>
                                        <field name="uploaded_by"/>
                                        <field name="is_latest_version"/>
                                        <field name="file_size"/>
                                    </tree>
                                </field>
                            </page>

                            <page name="access_log" string="Access Log">
                                <field name="access_log_ids" nolabel="1" readonly="1">
                                    <tree>
                                        <field name="user_id"/>
                                        <field name="access_type"/>
                                        <field name="access_date"/>
                                        <field name="ip_address"/>
                                        <field name="user_agent"/>
                                    </tree>
                                </field>
                            </page>

                            <page name="metadata" string="Metadata">
                                <group>
                                    <group name="creation" string="Creation">
                                        <field name="create_date" readonly="1"/>
                                        <field name="create_uid" readonly="1"/>
                                        <field name="write_date" readonly="1"/>
                                        <field name="write_uid" readonly="1"/>
                                    </group>
                                    <group name="technical" string="Technical">
                                        <field name="active"/>
                                        <field name="sequence"/>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                    </sheet>

                    <!-- Chatter -->
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>

        <!-- ================================= -->
        <!-- ACTIONS -->
        <!-- ================================= -->

        <!-- Main action for documents -->
        <record id="action_internship_document_list" model="ir.actions.act_window">
            <field name="name">Documents</field>
            <field name="res_model">internship.document</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="context">{'search_default_latest_versions': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Upload your first document!
                </p>
                <p>
                    Manage all internship documents: conventions, certificates, reports, and more.
                </p>
            </field>
        </record>

        <!-- My Documents Action (for students) -->
        <record id="action_internship_document_my" model="ir.actions.act_window">
            <field name="name">My Documents</field>
            <field name="res_model">internship.document</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="domain">[('student_id.user_id', '=', uid)]</field>
            <field name="context">{
                'default_student_id': uid,
                'search_default_my_documents': 1
            }</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Upload your first document!
                </p>
                <p>
                    Manage your internship documents: upload, track versions, and monitor review status.
                </p>
            </field>
        </record>

        <!-- Documents to Review Action (for supervisors) -->
        <record id="action_internship_document_review" model="ir.actions.act_window">
            <field name="name">Documents to Review</field>
            <field name="res_model">internship.document</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="domain">[
                ('supervisor_id.user_id', '=', uid),
                ('review_status', 'in', ['pending', 'under_review'])
            ]</field>
            <field name="context">{
                'default_supervisor_id': uid,
                'search_default_pending_review': 1
            }</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No documents to review!
                </p>
                <p>
                    Review and approve documents submitted by your students.
                </p>
            </field>
        </record>

    </data>
</odoo>