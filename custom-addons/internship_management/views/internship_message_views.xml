<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- ================================= -->
        <!-- MESSAGE MANAGEMENT VIEWS -->
        <!-- ================================= -->

        <!-- Message Tree View -->
        <record id="view_internship_message_tree" model="ir.ui.view">
            <field name="name">internship.message.tree</field>
            <field name="model">internship.message</field>
            <field name="arch" type="xml">
                <tree string="Messages"
                      decoration-info="state=='draft'"
                      decoration-warning="state=='sent'"
                      decoration-success="state=='read'"
                      decoration-muted="state=='archived'"
                      create="true"
                      multi_edit="1">

                    <!-- Message Information -->
                    <field name="subject"/>
                    <field name="sender_id"/>
                    <field name="recipient_ids" widget="many2many_tags"/>
                    <field name="message_type" widget="badge"/>
                    <field name="priority" widget="priority"/>
                    <field name="state" widget="badge"/>
                    <field name="create_date"/>

                    <!-- Actions -->
                    <button name="action_send" type="object" icon="fa-paper-plane"
                            title="Send Message" class="btn-link"
                            invisible="state != 'draft'" aria-label="Send"/>
                    <button name="action_mark_as_read" type="object" icon="fa-eye"
                            title="Mark as Read" class="btn-link"
                            invisible="state != 'sent'" aria-label="Mark Read"/>
                    <button name="action_archive" type="object" icon="fa-archive"
                            title="Archive" class="btn-link"
                            invisible="state == 'archived'" aria-label="Archive"/>
                </tree>
            </field>
        </record>

        <!-- Message Kanban View -->
        <record id="view_internship_message_kanban" model="ir.ui.view">
            <field name="name">internship.message.kanban</field>
            <field name="model">internship.message</field>
            <field name="arch" type="xml">
                <kanban default_group_by="message_type" class="o_kanban_small_column">
                    <field name="subject"/>
                    <field name="sender_id"/>
                    <field name="recipient_ids"/>
                    <field name="message_type"/>
                    <field name="priority"/>
                    <field name="state"/>
                    <field name="create_date"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_card oe_kanban_global_click #{record.state.raw_value == 'read' ? 'oe_kanban_color_success' : record.state.raw_value == 'sent' ? 'oe_kanban_color_info' : record.state.raw_value == 'archived' ? 'oe_kanban_color_muted' : ''}">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="subject"/>
                                        </strong>
                                        <div class="o_kanban_record_subtitle">
                                            <span class="badge badge-pill" t-attf-style="background-color: #{record.message_type.raw_value == 'urgent' ? '#dc3545' : record.message_type.raw_value == 'info' ? '#17a2b8' : record.message_type.raw_value == 'reminder' ? '#ffc107' : '#6c757d'};">
                                                <field name="message_type"/>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="o_kanban_manage_button_section">
                                        <a class="o_kanban_manage_toggle_button" href="#">
                                            <i class="fa fa-ellipsis-v" role="img" aria-label="Manage" title="Manage"/>
                                        </a>
                                    </div>
                                </div>
                                <div class="o_kanban_record_body">
                                    <div class="row">
                                        <div class="col-12">
                                            <i class="fa fa-user" title="Sender"/> <field name="sender_id"/>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <i class="fa fa-users" title="Recipients"/> <field name="recipient_ids" widget="many2many_tags"/>
                                        </div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col-6">
                                            <i class="fa fa-clock-o" title="Date"/> <field name="create_date"/>
                                        </div>
                                        <div class="col-6">
                                            <i class="fa fa-flag" title="Priority"/> <field name="priority" widget="priority"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <span class="badge badge-pill" t-attf-style="background-color: #{record.state.raw_value == 'draft' ? '#6c757d' : record.state.raw_value == 'sent' ? '#ffc107' : record.state.raw_value == 'read' ? '#28a745' : '#6c757d'};">
                                            <field name="state"/>
                                        </span>
                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <button name="action_send" type="object" icon="fa-paper-plane"
                                                title="Send" class="btn-link btn-sm"
                                                invisible="state != 'draft'"/>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Message Search View -->
        <record id="view_internship_message_search" model="ir.ui.view">
            <field name="name">internship.message.search</field>
            <field name="model">internship.message</field>
            <field name="arch" type="xml">
                <search string="Search Messages">
                    <!-- Search Fields -->
                    <field name="subject"/>
                    <field name="sender_id"/>
                    <field name="recipient_ids"/>
                    <field name="message_type"/>

                    <!-- Filters -->
                    <filter string="My Messages" name="my_messages"
                            domain="[('sender_id', '=', uid)]"/>
                    <filter string="Received Messages" name="received_messages"
                            domain="[('recipient_ids', 'in', uid)]"/>
                    <filter string="Draft" name="draft" domain="[('state', '=', 'draft')]"/>
                    <filter string="Sent" name="sent" domain="[('state', '=', 'sent')]"/>
                    <filter string="Read" name="read" domain="[('state', '=', 'read')]"/>
                    <filter string="Archived" name="archived" domain="[('state', '=', 'archived')]"/>

                    <!-- Type Filters -->
                    <separator/>
                    <filter string="Urgent" name="urgent" domain="[('message_type', '=', 'urgent')]"/>
                    <filter string="Information" name="info" domain="[('message_type', '=', 'info')]"/>
                    <filter string="Reminders" name="reminders" domain="[('message_type', '=', 'reminder')]"/>

                    <!-- Group By -->
                    <group expand="0" string="Group By">
                        <filter string="Status" name="group_state" context="{'group_by': 'state'}"/>
                        <filter string="Type" name="group_type" context="{'group_by': 'message_type'}"/>
                        <filter string="Sender" name="group_sender" context="{'group_by': 'sender_id'}"/>
                        <filter string="Date" name="group_date" context="{'group_by': 'create_date:day'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Message Form View -->
        <record id="view_internship_message_form" model="ir.ui.view">
            <field name="name">internship.message.form</field>
            <field name="model">internship.message</field>
            <field name="arch" type="xml">
                <form string="Message Management" class="o_message_form">
                    <header>
                        <!-- Action Buttons -->
                        <button name="action_send" string="Send Message" type="object"
                                class="oe_highlight" icon="fa-paper-plane"
                                invisible="state != 'draft'"/>
                        <button name="action_mark_as_read" string="Mark as Read" type="object"
                                class="btn-info" icon="fa-eye"
                                invisible="state != 'sent'"/>
                        <button name="action_archive" string="Archive" type="object"
                                class="btn-secondary" icon="fa-archive"
                                invisible="state == 'archived'"/>

                        <!-- Statusbar -->
                        <field name="state" widget="statusbar"
                               statusbar_visible="draft,sent,read,archived"/>
                    </header>

                    <sheet>
                        <!-- Title -->
                        <div class="oe_title">
                            <h1>
                                <field name="subject" placeholder="Message subject..."/>
                            </h1>
                        </div>

                        <!-- Main Information -->
                        <group>
                            <group string="Message Information">
                                <field name="sender_id" readonly="1"/>
                                <field name="create_date" readonly="1"/>
                                <field name="message_type"/>
                                <field name="priority" widget="priority"/>
                            </group>
                            <group string="Recipients">
                                <field name="recipient_ids" options="{'no_create': True}"/>
                            </group>
                        </group>

                        <!-- Alerts -->
                        <div class="alert alert-info" role="alert"
                             invisible="state != 'draft'">
                            <i class="fa fa-info-circle"/>
                            This message is in draft mode. Add recipients and send when ready.
                        </div>

                        <div class="alert alert-warning" role="alert"
                             invisible="state != 'sent'">
                            <i class="fa fa-clock-o"/>
                            This message has been sent and is awaiting to be read.
                        </div>

                        <div class="alert alert-success" role="alert"
                             invisible="state != 'read'">
                            <i class="fa fa-check-circle"/>
                            This message has been read by the recipients.
                        </div>

                        <!-- Content and Relations -->
                        <notebook>
                            <page string="Message Content" name="content">
                                <field name="body" nolabel="1"
                                       placeholder="Write your message here..."/>
                            </page>

                            <page string="Related Objects" name="relations">
                                <group>
                                    <group string="Internship Relations">
                                    <field name="stage_id"/>
                                    <field name="document_id"/>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                    </sheet>

                    <!-- Chatter -->
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>

        <!-- ================================= -->
        <!-- ACTIONS -->
        <!-- ================================= -->

        <!-- Main action for messages -->
        <record id="action_internship_message_list" model="ir.actions.act_window">
            <field name="name">Messages</field>
            <field name="res_model">internship.message</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="context">{'search_default_my_messages': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Send your first message!
                </p>
                <p>
                    Communicate with other users in the internship management system.
                </p>
            </field>
        </record>

        <!-- Action for received messages -->
        <record id="action_internship_message_received" model="ir.actions.act_window">
            <field name="name">Received Messages</field>
            <field name="res_model">internship.message</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="domain">[('recipient_ids', 'in', uid)]</field>
            <field name="context">{'search_default_received_messages': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No messages received yet!
                </p>
                <p>
                    Messages sent to you will appear here.
                </p>
            </field>
        </record>

    </data>
</odoo>