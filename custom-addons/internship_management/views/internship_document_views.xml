<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- ================================= -->
        <!-- DOCUMENT MANAGEMENT VIEWS -->
        <!-- ================================= -->

        <!-- Document Tree View -->
        <record id="view_internship_document_tree" model="ir.ui.view">
            <field name="name">internship.document.tree</field>
        <field name="model">internship.document</field>
        <field name="arch" type="xml">
                <tree string="Documents"
                      decoration-info="state=='draft'"
                      decoration-warning="state=='submitted'"
                      decoration-primary="state=='under_review'"
                      decoration-success="state=='approved'"
                      decoration-danger="state=='rejected'"
                      decoration-muted="state=='archived'"
                      create="true"
                      multi_edit="1">

                    <!-- Document Information -->
                    <field name="name"/>
                    <field name="document_type" widget="badge"/>
                    <field name="stage_id"/>
                    <field name="student_id"/>
                    <field name="supervisor_id"/>

                    <!-- Status and Dates -->
                    <field name="state" widget="badge"/>
                    <field name="date_upload"/>
                    <field name="review_deadline"/>

                    <!-- File Details -->
                    <field name="file_size" widget="progressbar"/>
                    <field name="version"/>
                    <field name="file" invisible="1"/>

                    <!-- Actions -->
                    <button name="action_download" type="object" icon="fa-download"
                            title="Download Document" class="btn-link"
                            invisible="not file" aria-label="Download"/>
                    <button name="action_submit_for_review" type="object" icon="fa-paper-plane"
                            title="Submit for Review" class="btn-link"
                            invisible="state != 'draft'" aria-label="Submit"/>
                    <button name="action_approve" type="object" icon="fa-check"
                            title="Approve" class="btn-link text-success"
                            invisible="state != 'under_review'"
                             aria-label="Approve"/>
                    <button name="action_reject" type="object" icon="fa-times"
                            title="Reject" class="btn-link text-danger"
                            invisible="state != 'under_review'"
                             aria-label="Reject"/>
                    <button name="action_archive" type="object" icon="fa-archive"
                            title="Archive" class="btn-link text-secondary"
                            invisible="state not in ['approved','rejected']" aria-label="Archive"/>
                </tree>
        </field>
    </record>

        <!-- Document Kanban View -->
    <record id="view_internship_document_kanban" model="ir.ui.view">
        <field name="name">internship.document.kanban</field>
        <field name="model">internship.document</field>
        <field name="arch" type="xml">
                <kanban default_group_by="state" class="o_kanban_small_column">
                <field name="name"/>
                <field name="document_type"/>
                    <field name="stage_id"/>
                    <field name="student_id"/>
                    <field name="supervisor_id"/>
                <field name="state"/>
                <field name="date_upload"/>
                    <field name="review_deadline"/>
                    <field name="file_size"/>
                <field name="version"/>
                    <field name="file" invisible="1"/>
                    <field name="review_required"/>
                <field name="reviewed_by"/>
                    <field name="review_date"/>
                <templates>
                    <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_card oe_kanban_global_click #{record.state.raw_value == 'approved' ? 'oe_kanban_color_success' : record.state.raw_value == 'rejected' ? 'oe_kanban_color_danger' : record.state.raw_value == 'under_review' ? 'oe_kanban_color_info' : ''}">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                        </strong>
                                        <div class="o_kanban_record_subtitle">
                                            <span class="badge badge-pill" t-attf-style="background-color: #{record.document_type.raw_value == 'convention' ? '#875A7B' : record.document_type.raw_value == 'progress_report' ? '#28a745' : record.document_type.raw_value == 'final_report' ? '#17a2b8' : record.document_type.raw_value == 'presentation' ? '#ffc107' : '#6c757d'};">
                                                <field name="document_type"/>
                                            </span>
                                            <span class="badge badge-secondary">v<field name="version"/></span>
                                        </div>
                                    </div>
                                    <div class="o_kanban_manage_button_section">
                                        <a class="o_kanban_manage_toggle_button" href="#">
                                            <i class="fa fa-ellipsis-v" role="img" aria-label="Manage" title="Manage"/>
                                        </a>
                                    </div>
                                </div>
                                <div class="o_kanban_record_body">
                                    <div class="row">
                                        <div class="col-12">
                                            <i class="fa fa-user" title="Student"/> <field name="student_id"/>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <i class="fa fa-user-tie" title="Supervisor"/> <field name="supervisor_id"/>
                                        </div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col-6">
                                            <i class="fa fa-calendar" title="Upload Date"/> <field name="date_upload"/>
                                        </div>
                                        <div class="col-6" t-if="record.review_deadline.raw_value">
                                            <i class="fa fa-clock-o" title="Review Deadline"/> <field name="review_deadline"/>
                                        </div>
                                    </div>
                                    <div class="row mt-2" t-if="record.file_size.raw_value > 0">
                                        <div class="col-12">
                                            <div class="progress" style="height: 15px;">
                                                <div class="progress-bar" role="progressbar"
                                                     t-attf-style="width: #{Math.min(record.file_size.raw_value / 1048576 * 2, 100)}%"
                                                     t-attf-aria-valuenow="#{record.file_size.raw_value}"
                                                     aria-valuemin="0" aria-valuemax="10485760">
                                                    <small><t t-esc="Math.round(record.file_size.raw_value / 1024)"/> KB</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <span class="badge badge-pill" t-attf-style="background-color: #{record.state.raw_value == 'draft' ? '#6c757d' : record.state.raw_value == 'submitted' ? '#ffc107' : record.state.raw_value == 'under_review' ? '#17a2b8' : record.state.raw_value == 'approved' ? '#28a745' : record.state.raw_value == 'rejected' ? '#dc3545' : '#6c757d'};">
                                            <field name="state"/>
                                        </span>
                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <button name="action_download" type="object" icon="fa-download"
                                                title="Download" class="btn-link btn-sm"
                                                invisible="not file"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

        <!-- Document Search View -->
        <record id="view_internship_document_search" model="ir.ui.view">
            <field name="name">internship.document.search</field>
       <field name="model">internship.document</field>
       <field name="arch" type="xml">
                <search string="Search Documents">
                    <!-- Search Fields -->
                    <field name="name"/>
                    <field name="document_type"/>
               <field name="stage_id"/>
                    <field name="student_id"/>
                    <field name="supervisor_id"/>
                    <field name="keywords"/>

                    <!-- Filters -->
                    <filter string="My Documents" name="my_documents"
                            domain="[('uploaded_by', '=', uid)]"/>
                    <filter string="To Review" name="to_review"
                            domain="[('state', 'in', ['submitted', 'under_review']), ('supervisor_id.user_id', '=', uid)]"/>
                    <filter string="Approved" name="approved" domain="[('state', '=', 'approved')]"/>
                    <filter string="Rejected" name="rejected" domain="[('state', '=', 'rejected')]"/>
                    <filter string="Draft" name="draft" domain="[('state', '=', 'draft')]"/>

                    <!-- Type Filters -->
                    <separator/>
                    <filter string="Conventions" name="conventions" domain="[('document_type', '=', 'convention')]"/>
                    <filter string="Reports" name="reports" domain="[('document_type', 'in', ['progress_report', 'final_report'])]"/>
                    <filter string="Presentations" name="presentations" domain="[('document_type', '=', 'presentation')]"/>
                    <filter string="Evaluations" name="evaluations" domain="[('document_type', '=', 'evaluation')]"/>

                    <!-- Group By -->
                    <group expand="0" string="Group By">
                        <filter string="Status" name="group_state" context="{'group_by': 'state'}"/>
                        <filter string="Type" name="group_type" context="{'group_by': 'document_type'}"/>
                        <filter string="Internship" name="group_stage" context="{'group_by': 'stage_id'}"/>
                        <filter string="Uploader" name="group_uploader" context="{'group_by': 'uploaded_by'}"/>
                    </group>
                </search>
       </field>
   </record>

        <!-- Document Form View -->
   <record id="view_internship_document_form" model="ir.ui.view">
       <field name="name">internship.document.form</field>
       <field name="model">internship.document</field>
       <field name="arch" type="xml">
           <form string="Document Management" class="o_document_form">
               <header>
                        <!-- Action Buttons -->
                        <button name="action_submit_for_review" string="Submit for Review" type="object"
                                class="oe_highlight" icon="fa-paper-plane"
                                invisible="state != 'draft'"/>
                        <button name="action_start_review" string="Start Review" type="object"
                                class="btn-info" icon="fa-eye"
                                invisible="state != 'submitted'"
                                />
                        <button name="action_approve" string="Approve" type="object"
                                class="btn-success" icon="fa-check"
                                invisible="state != 'under_review'"
                                />
                        <button name="action_reject" string="Reject" type="object"
                                class="btn-danger" icon="fa-times"
                                invisible="state != 'under_review'"
                                />
                        <button name="action_archive" string="Archive" type="object"
                                class="btn-secondary" icon="fa-archive"
                                invisible="state not in ['approved','rejected']"/>

                        <!-- Feedback Actions -->
                        <button name="action_add_feedback" string="Add Feedback" type="object"
                                class="btn-primary" icon="fa-comment"/>
                        <button name="action_view_feedback" string="View Feedback" type="object"
                                class="btn-info" icon="fa-list"/>

                   <!-- Statusbar -->
                   <field name="state" widget="statusbar"
                          statusbar_visible="draft,submitted,under_review,approved"/>
               </header>

               <sheet>
                         <style>
                            .o_field_text textarea {
                                min-height: 150px !important;
                                resize: vertical !important;
                            }
                            .o_field_html .note-editable {
                                min-height: 150px !important;
                            }
                        </style>
                        <!-- Title -->
                   <div class="oe_title">
                       <h1>
                           <field name="name" placeholder="Document Title" required="1"/>
                       </h1>
                   </div>

                        <!-- Main Information -->
                        <group>
                            <group string="Document Information">
                                <field name="stage_id" required="1"/>
                                <field name="document_type" required="1"
                                       invisible="state != 'draft'"/>
                                <field name="version"/>
                                <field name="file" filename="filename" required="1"/>
                                <field name="filename" invisible="1"/>
                            </group>
                            <group string="Metadata">
                                <field name="date_upload" readonly="1"/>
                                <field name="uploaded_by" readonly="1"/>
                                <field name="last_modified" readonly="1"/>
                                <field name="file_size" readonly="1"/>
                                <field name="file_type" readonly="1"/>
                            </group>
                        </group>

                        <!-- Alerts -->
                   <div class="alert alert-info" role="alert"
                             invisible="state != 'draft'">
                       <i class="fa fa-info-circle"/>
                       This document is in draft mode. Upload a file and submit for review.
                   </div>

                   <div class="alert alert-warning" role="alert"
                             invisible="state != 'submitted'">
                       <i class="fa fa-clock-o"/>
                       This document is awaiting review from your supervisor.
                   </div>

                   <div class="alert alert-success" role="alert"
                             invisible="state != 'approved'">
                       <i class="fa fa-check-circle"/>
                       This document has been approved!
                   </div>

                        <div class="alert alert-danger" role="alert"
                             invisible="state != 'rejected'">
                            <i class="fa fa-times-circle"/>
                            This document has been rejected. Please review comments and resubmit.
                        </div>

                        <!-- Description and Comments -->
                   <notebook>
                            <page string="Description &amp; Comments" name="description_comments">
                                <div class="row">
                                    <div class="col-12">
                                        <label for="description" class="o_form_label">Description</label>
                                        <field name="description" nolabel="1" widget="html"
                                               placeholder="Detailed description of the document content..."
                                               class="o_field_html"/>
                                    </div>
                                </div>

                                <div class="row mt16">
                                    <div class="col-12">
                                        <label for="comments" class="o_form_label">Internal Comments</label>
                                        <field name="comments" nolabel="1"
                                               placeholder="Internal notes and comments about the document..."
                                               class="o_field_text"/>
                                    </div>
                                </div>

                                <div class="row mt16">
                                    <div class="col-12">
                                        <label for="keywords" class="o_form_label">Keywords</label>
                                        <field name="keywords" nolabel="1"
                                               placeholder="Comma-separated keywords for better searchability..."/>
                                    </div>
                                </div>
                       </page>

                            <!-- Review Tab -->
                            <page string="Review Process" name="review"
                              invisible="not review_required">
                           <group>
                               <group string="Review Settings">
                                   <field name="review_required"/>
                                   <field name="review_deadline"
                                          required="review_required"/>
                               </group>
                               <group string="Review Status"
                                           invisible="state == 'draft'">
                                   <field name="reviewed_by" readonly="1"
                                          widget="many2one_avatar_user"/>
                                   <field name="review_date" readonly="1"/>
                               </group>
                           </group>

                           <group string="Review Comments"
                                 invisible="not review_comments">
                               <field name="review_comments" widget="html" nolabel="1" readonly="1"/>
                           </group>
                       </page>

                            <!-- Access Control Tab -->
                            <page string="Access Control" name="access_control">
                           <group>
                                    <group string="Visibility">
                                   <field name="is_public"/>
                                   <field name="access_level"/>
                               </group>
                                </group>
                            </page>

                            <!-- Technical Details Tab -->
                            <page string="Technical Details" name="technical_details">
                                <group>
                                    <group string="System Information">
                                        <field name="create_date" readonly="1"/>
                                        <field name="create_uid" readonly="1"/>
                                        <field name="write_date" readonly="1"/>
                                        <field name="write_uid" readonly="1"/>
                                    </group>
                                    <group string="Other">
                                        <field name="active"/>
                                   <field name="sequence"/>
                               </group>
                           </group>
                       </page>

                       <!-- Document Feedback Page -->
                       <page string="Feedback" name="feedback">
                           <group>
                               <group string="Feedback Statistics">
                                   <field name="feedback_count"/>
                                   <field name="pending_feedback_count"/>
                               </group>
                               <group string="Recent Activity">
                                   <field name="last_feedback_date"/>
                                   <field name="last_reviewer_id"/>
                               </group>
                           </group>
                           <group string="Document Feedback">
                               <field name="feedback_ids" widget="one2many">
                                   <tree>
                                       <field name="feedback_summary"/>
                                       <field name="reviewer_id"/>
                                       <field name="feedback_type"/>
                                       <field name="priority" widget="priority"/>
                                       <field name="status"/>
                                       <field name="create_date"/>
                                   </tree>
                               </field>
                           </group>
                       </page>
                   </notebook>
               </sheet>

                    <!-- Chatter -->
               <div class="oe_chatter">
                   <field name="message_follower_ids" widget="message_follower"/>
                   <field name="activity_ids" widget="activity"/>
                   <field name="message_ids"  widget="message"/>
               </div>
           </form>
       </field>
   </record>

        <!-- ================================= -->
        <!-- ACTIONS -->
        <!-- ================================= -->

        <!-- Main action for documents -->
        <record id="action_internship_document_list" model="ir.actions.act_window">
       <field name="name">Documents</field>
       <field name="res_model">internship.document</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'search_default_my_documents': 1}</field>
       <field name="help" type="html">
           <p class="o_view_nocontent_smiling_face">
               Upload your first document!
           </p>
           <p>
                    Manage all documents related to internships.
           </p>
       </field>
   </record>

        <!-- Action for documents to review -->
   <record id="action_internship_document_review" model="ir.actions.act_window">
       <field name="name">Documents to Review</field>
       <field name="res_model">internship.document</field>
       <field name="view_mode">tree,form</field>
            <field name="domain">[('state', 'in', ['submitted', 'under_review']), ('supervisor_id.user_id', '=', uid)]</field>
            <field name="context">{'search_default_to_review': 1}</field>
       <field name="help" type="html">
           <p class="o_view_nocontent_smiling_face">
                    No documents to review!
           </p>
           <p>
                    Documents submitted by students for your review will appear here.
           </p>
       </field>
   </record>

        <!-- Action for my documents (students) -->
   <record id="action_internship_document_my" model="ir.actions.act_window">
       <field name="name">My Documents</field>
       <field name="res_model">internship.document</field>
            <field name="view_mode">tree,form</field>
       <field name="domain">[('student_id.user_id', '=', uid)]</field>
            <field name="context">{'search_default_my_documents': 1}</field>
       <field name="help" type="html">
           <p class="o_view_nocontent_smiling_face">
                    Upload your documents here!
           </p>
           <p>
                    All documents you have uploaded for your internships will be listed here.
           </p>
       </field>
   </record>

    </data>
</odoo>