<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="dashboard_template_modern" name="Dashboard Moderne - Gestion Stages">
        <t t-call="web.layout">
            <t t-set="head">
                <!-- Resources CSS/JS -->
                <link rel="stylesheet" href="/internship_management/static/src/css/dashboard_modern.css"/>
                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
                <script src="/internship_management/static/src/js/dashboard_modern.js"></script>
            </t>

            <!-- Header -->
            <header class="modern-header">
                <div class="header-content">
                    <div class="header-title">
                        <div class="header-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="header-text">
                            <h1>Dashboard - Gestion des Stages</h1>
                            <p>Plateforme de suivi et gestion des stages</p>
                        </div>
                    </div>
                    
                    <div class="user-info">
                        <div class="user-details">
                            <h3><t t-esc="user.name"/></h3>
                            <p>
                                <t t-if="user.has_group('internship_management.group_internship_admin')">
                                    Administrateur
                                </t>
                                <t t-elif="user.has_group('internship_management.group_internship_supervisor')">
                                    Encadrant
                                </t>
                                <t t-elif="user.has_group('internship_management.group_internship_student')">
                                    Étudiant
                                </t>
                                <t t-else="">
                                    Utilisateur
                                </t>
                            </p>
                        </div>
                        <div class="user-avatar">
                            <t t-esc="user.name[:2].upper()"/>
                        </div>
                    </div>
                </div>
            </header>

            <main class="dashboard-container">
                <!-- Statistics Section -->
                <section class="stats-section">
                    <div class="stats-grid" id="statsGrid">
                        <!-- Admin Stats -->
                        <t t-if="user.has_group('internship_management.group_internship_admin')">
                            <div class="stat-card primary">
                                <div class="stat-header">
                                    <div class="stat-icon">
                                        <i class="fas fa-graduation-cap"></i>
                                    </div>
                                    <div class="stat-trend trend-up">
                                        <i class="fas fa-arrow-up"></i>
                                        <span>+12%</span>
                                    </div>
                                </div>
                                <div class="stat-value"><t t-esc="stats.get('total_stages', 0)"/></div>
                                <div class="stat-label">Total Stages</div>
                                <div class="stat-description">vs mois dernier</div>
                            </div>

                            <div class="stat-card success">
                                <div class="stat-header">
                                    <div class="stat-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div class="stat-trend trend-up">
                                        <i class="fas fa-arrow-up"></i>
                                        <span>+5%</span>
                                    </div>
                                </div>
                                <div class="stat-value"><t t-esc="stats.get('total_students', 0)"/></div>
                                <div class="stat-label">Étudiants</div>
                                <div class="stat-description">actifs</div>
                            </div>

                            <div class="stat-card info">
                                <div class="stat-header">
                                    <div class="stat-icon">
                                        <i class="fas fa-user-tie"></i>
                                    </div>
                                    <div class="stat-trend trend-up">
                                        <i class="fas fa-arrow-up"></i>
                                        <span>+2%</span>
                                    </div>
                                </div>
                                <div class="stat-value"><t t-esc="stats.get('total_supervisors', 0)"/></div>
                                <div class="stat-label">Encadrants</div>
                                <div class="stat-description">disponibles</div>
                            </div>

                            <div class="stat-card warning">
                                <div class="stat-header">
                                    <div class="stat-icon">
                                        <i class="fas fa-building"></i>
                                    </div>
                                    <div class="stat-trend">
                                        <i class="fas fa-minus"></i>
                                        <span>0%</span>
                                    </div>
                                </div>
                                <div class="stat-value"><t t-esc="stats.get('total_companies', 0)"/></div>
                                <div class="stat-label">Entreprises</div>
                                <div class="stat-description">partenaires</div>
                            </div>

                            <div class="stat-card primary">
                                <div class="stat-header">
                                    <div class="stat-icon">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <div class="stat-trend trend-down">
                                        <i class="fas fa-arrow-down"></i>
                                        <span>-3%</span>
                                    </div>
                                </div>
                                <div class="stat-value"><t t-esc="stats.get('stages_in_progress', 0)"/></div>
                                <div class="stat-label">En Cours</div>
                                <div class="stat-description">stages actifs</div>
                            </div>

                            <div class="stat-card success">
                                <div class="stat-header">
                                    <div class="stat-icon">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                    <div class="stat-trend trend-up">
                                        <i class="fas fa-arrow-up"></i>
                                        <span>+8%</span>
                                    </div>
                                </div>
                                <div class="stat-value"><t t-esc="stats.get('stages_completed', 0) + stats.get('stages_evaluated', 0)"/></div>
                                <div class="stat-label">Terminés</div>
                                <div class="stat-description">avec succès</div>
                            </div>
                        </t>

                        <!-- Supervisor Stats -->
                        <t t-if="user.has_group('internship_management.group_internship_supervisor') and role_stats">
                            <div class="stat-card primary">
                                <div class="stat-header">
                                    <div class="stat-icon">
                                        <i class="fas fa-graduation-cap"></i>
                                    </div>
                                </div>
                                <div class="stat-value"><t t-esc="role_stats.get('my_stages_count', 0)"/></div>
                                <div class="stat-label">Mes Stages</div>
                                <div class="stat-description">en supervision</div>
                            </div>

                            <div class="stat-card success">
                                <div class="stat-header">
                                    <div class="stat-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                </div>
                                <div class="stat-value"><t t-esc="role_stats.get('my_students_count', 0)"/></div>
                                <div class="stat-label">Mes Étudiants</div>
                                <div class="stat-description">encadrés</div>
                            </div>

                            <div class="stat-card info">
                                <div class="stat-header">
                                    <div class="stat-icon">
                                        <i class="fas fa-percentage"></i>
                                    </div>
                                </div>
                                <div class="stat-value"><t t-esc="'%.1f' % role_stats.get('my_avg_progress', 0)"/>%</div>
                                <div class="stat-label">Progression</div>
                                <div class="stat-description">moyenne</div>
                            </div>

                            <div class="stat-card warning">
                                <div class="stat-header">
                                    <div class="stat-icon">
                                        <i class="fas fa-gavel"></i>
                                    </div>
                                </div>
                                <div class="stat-value"><t t-esc="role_stats.get('my_defense_completed', 0)"/></div>
                                <div class="stat-label">Soutenances</div>
                                <div class="stat-description">terminées</div>
                            </div>
                        </t>

                        <!-- Student Stats -->
                        <t t-if="user.has_group('internship_management.group_internship_student') and role_stats">
                            <div class="stat-card primary">
                                <div class="stat-header">
                                    <div class="stat-icon">
                                        <i class="fas fa-graduation-cap"></i>
                                    </div>
                                </div>
                                <div class="stat-value"><t t-esc="role_stats.get('my_stages_count', 0)"/></div>
                                <div class="stat-label">Mes Stages</div>
                                <div class="stat-description">au total</div>
                            </div>

                            <div class="stat-card info">
                                <div class="stat-header">
                                    <div class="stat-icon">
                                        <i class="fas fa-percentage"></i>
                                    </div>
                                </div>
                                <div class="stat-value"><t t-esc="'%.1f' % role_stats.get('my_progress', 0)"/>%</div>
                                <div class="stat-label">Ma Progression</div>
                                <div class="stat-description">actuelle</div>
                            </div>

                            <div class="stat-card success">
                                <div class="stat-header">
                                    <div class="stat-icon">
                                        <i class="fas fa-star"></i>
                                    </div>
                                </div>
                                <div class="stat-value"><t t-esc="'%.1f' % role_stats.get('my_grade', 0)"/></div>
                                <div class="stat-label">Note Moyenne</div>
                                <div class="stat-description">obtenue</div>
                            </div>
                        </t>
                    </div>
                </section>

                <!-- Charts Section -->
                <section class="charts-section">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">
                                <i class="fas fa-pie-chart"></i>
                                Répartition par État
                            </h3>
                            <button class="refresh-btn" onclick="refreshChart('states')" title="Actualiser">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                        <div class="chart-content">
                            <ul class="data-list">
                                <li class="data-item">
                                    <div class="data-label">
                                        <span class="status-dot draft"></span>
                                        <span>Brouillon</span>
                                    </div>
                                    <span class="data-count"><t t-esc="stats.get('stages_draft', 0)"/></span>
                                </li>
                                <li class="data-item">
                                    <div class="data-label">
                                        <span class="status-dot submitted"></span>
                                        <span>Soumis</span>
                                    </div>
                                    <span class="data-count"><t t-esc="stats.get('stages_submitted', 0)"/></span>
                                </li>
                                <li class="data-item">
                                    <div class="data-label">
                                        <span class="status-dot approved"></span>
                                        <span>Approuvé</span>
                                    </div>
                                    <span class="data-count"><t t-esc="stats.get('stages_approved', 0)"/></span>
                                </li>
                                <li class="data-item">
                                    <div class="data-label">
                                        <span class="status-dot progress"></span>
                                        <span>En cours</span>
                                    </div>
                                    <span class="data-count"><t t-esc="stats.get('stages_in_progress', 0)"/></span>
                                </li>
                                <li class="data-item">
                                    <div class="data-label">
                                        <span class="status-dot completed"></span>
                                        <span>Terminé</span>
                                    </div>
                                    <span class="data-count"><t t-esc="stats.get('stages_completed', 0)"/></span>
                                </li>
                                <li class="data-item">
                                    <div class="data-label">
                                        <span class="status-dot evaluated"></span>
                                        <span>Évalué</span>
                                    </div>
                                    <span class="data-count"><t t-esc="stats.get('stages_evaluated', 0)"/></span>
                                </li>
                                <li class="data-item">
                                    <div class="data-label">
                                        <span class="status-dot cancelled"></span>
                                        <span>Annulé</span>
                                    </div>
                                    <span class="data-count"><t t-esc="stats.get('stages_cancelled', 0)"/></span>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">
                                <i class="fas fa-bar-chart"></i>
                                Répartition par Type
                            </h3>
                            <button class="refresh-btn" onclick="refreshChart('types')" title="Actualiser">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                        <div class="chart-content">
                            <ul class="data-list">
                                <li class="data-item">
                                    <div class="data-label">
                                        <span class="status-dot progress"></span>
                                        <span>PFE</span>
                                    </div>
                                    <span class="data-count"><t t-esc="stats.get('pfe_count', 0)"/></span>
                                </li>
                                <li class="data-item">
                                    <div class="data-label">
                                        <span class="status-dot success"></span>
                                        <span>Stage d'été</span>
                                    </div>
                                    <span class="data-count"><t t-esc="stats.get('summer_internship_count', 0)"/></span>
                                </li>
                                <li class="data-item">
                                    <div class="data-label">
                                        <span class="status-dot warning"></span>
                                        <span>Stage d'observation</span>
                                    </div>
                                    <span class="data-count"><t t-esc="stats.get('observation_count', 0)"/></span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- Actions Section -->
                <section class="actions-section">
                    <h3 class="section-title">
                        <i class="fas fa-bolt"></i>
                        Actions Rapides
                    </h3>
                    <div class="actions-grid">
                        <a href="/web#action=internship_management.action_internship_stage_list" 
                           class="action-btn primary">
                            <i class="fas fa-list action-icon"></i>
                            <div class="action-content">
                                <span class="action-title">Tous les Stages</span>
                                <small class="action-subtitle">Gérer et suivre</small>
                            </div>
                        </a>
                        
                        <a href="/web#action=internship_management.action_internship_student_list" 
                           class="action-btn success">
                            <i class="fas fa-users action-icon"></i>
                            <div class="action-content">
                                <span class="action-title">Étudiants</span>
                                <small class="action-subtitle">Gérer les profils</small>
                            </div>
                        </a>
                        
                        <a href="/web#action=internship_management.action_internship_supervisor_list" 
                           class="action-btn">
                            <i class="fas fa-user-tie action-icon"></i>
                            <div class="action-content">
                                <span class="action-title">Encadrants</span>
                                <small class="action-subtitle">Supervision</small>
                            </div>
                        </a>
                        
                        <a href="/web#action=internship_management.action_internship_notification_list" 
                           class="action-btn warning">
                            <i class="fas fa-bell action-icon"></i>
                            <div class="action-content">
                                <span class="action-title">Notifications</span>
                                <small class="action-subtitle">Alertes et messages</small>
                            </div>
                        </a>
                        
                        <a href="/web#action=base.action_res_company_form" 
                           class="action-btn">
                            <i class="fas fa-building action-icon"></i>
                            <div class="action-content">
                                <span class="action-title">Entreprises</span>
                                <small class="action-subtitle">Partenaires</small>
                            </div>
                        </a>
                        
                        <a href="/web#action=internship_management.action_internship_meeting_list" 
                           class="action-btn">
                            <i class="fas fa-calendar action-icon"></i>
                            <div class="action-content">
                                <span class="action-title">Planning</span>
                                <small class="action-subtitle">Réunions</small>
                            </div>
                        </a>
                        
                        <a href="/web#menu_id=internship_management.menu_internship_config" 
                           class="action-btn">
                            <i class="fas fa-file-alt action-icon"></i>
                            <div class="action-content">
                                <span class="action-title">Documents</span>
                                <small class="action-subtitle">Templates</small>
                            </div>
                        </a>
                        
                        <a href="/web#menu_id=internship_management.menu_internship_config" 
                           class="action-btn">
                            <i class="fas fa-cog action-icon"></i>
                            <div class="action-content">
                                <span class="action-title">Configuration</span>
                                <small class="action-subtitle">Paramètres</small>
                            </div>
                        </a>
                    </div>
                </section>

                <!-- Recent Activities -->
                <section class="activity-section">
                    <h3 class="section-title">
                        <i class="fas fa-clock"></i>
                        Activités Récentes
                    </h3>
                    <div class="activities-list" id="activitiesList">
                        <!-- Dynamic content loaded by JavaScript -->
                    </div>
                </section>
            </main>

            <!-- Initialize Dashboard -->
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    if (typeof InternshipDashboard !== 'undefined') {
                        InternshipDashboard.init({
                            user: {
                                name: '<t t-esc="user.name"/>',
                                role: '<t t-if="user.has_group(\'internship_management.group_internship_admin\')">admin</t><t t-elif="user.has_group(\'internship_management.group_internship_supervisor\')">supervisor</t><t t-elif="user.has_group(\'internship_management.group_internship_student\')">student</t><t t-else="">user</t>'
                            },
                            stats: {
                                total_stages: <t t-esc="stats.get('total_stages', 0)"/>,
                                stages_in_progress: <t t-esc="stats.get('stages_in_progress', 0)"/>,
                                stages_completed: <t t-esc="stats.get('stages_completed', 0)"/>
                            }
                        });
                    }
                });
            </script>
        </t>
    </template>
</odoo>