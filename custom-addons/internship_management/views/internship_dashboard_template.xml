<?xml version="1.0" encoding="utf-8"?>
<templates>
    <!-- Main Dashboard Template -->
    <t t-name="internship_management.RoleDashboardTemplate">
        <div class="o_internship_dashboard">
            <!-- Loading State -->
            <div t-if="state.isLoading" class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3 text-muted">Loading dashboard...</p>
            </div>

            <!-- Dashboard Content -->
            <div t-else="" class="dashboard-content">
                <!-- Header -->
                <div class="dashboard-header mb-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h2 class="mb-1">
                                <i class="fa fa-tachometer-alt text-primary me-2"></i>
                                <t t-if="state.userRole === 'student'">Student Dashboard</t>
                                <t t-elif="state.userRole === 'supervisor'">Supervisor Dashboard</t>
                                <t t-elif="state.userRole === 'admin'">Admin Dashboard</t>
                                <t t-else="">Internship Dashboard</t>
                            </h2>
                            <p class="text-muted mb-0">Welcome back! Here's your internship overview.</p>
                        </div>
                        <div class="header-actions">
                            <button class="btn btn-outline-primary btn-sm me-2" t-on-click="refreshDashboard">
                                <i class="fa fa-refresh me-1"></i>
                                Refresh
                            </button>
                            <div class="dropdown">
                                <button class="btn btn-primary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="fa fa-plus me-1"></i>
                                    Actions
                                </button>
                                <ul class="dropdown-menu">
                                    <li t-if="state.userRole === 'student'">
                                        <a class="dropdown-item" href="#" t-on-click="viewMyInternships">
                                            <i class="fa fa-graduation-cap me-2"></i>
                                            My Internships
                                        </a>
                                    </li>
                                    <li t-if="state.userRole === 'supervisor'">
                                        <a class="dropdown-item" href="#" t-on-click="viewMyStudents">
                                            <i class="fa fa-users me-2"></i>
                                            My Students
                                        </a>
                                    </li>
                                    <li t-if="state.userRole === 'admin'">
                                        <a class="dropdown-item" href="#" t-on-click="viewAllInternships">
                                            <i class="fa fa-list me-2"></i>
                                            All Internships
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- KPI Cards -->
                <div class="kpi-section mb-4" t-if="state.dashboardData.kpi_cards">
                    <div class="row g-3">
                        <div t-foreach="state.dashboardData.kpi_cards" t-as="kpi" t-key="kpi.id" class="col-xl-3 col-md-6">
                            <div class="card kpi-card h-100">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="kpi-icon me-3">
                                            <i t-att-class="'fa ' + kpi.icon + ' text-' + kpi.color"></i>
                                        </div>
                                        <div class="kpi-content flex-grow-1">
                                            <h5 class="kpi-value mb-1" t-esc="kpi.value"></h5>
                                            <p class="kpi-title text-muted mb-0" t-esc="kpi.title"></p>
                                        </div>
                                        <div t-if="kpi.trend" class="kpi-trend">
                                            <small t-att-class="'badge bg-' + (kpi.trend_direction === 'up' ? 'success' : 'danger')">
                                                <i t-att-class="'fa fa-arrow-' + kpi.trend_direction + ' me-1'"></i>
                                                <t t-esc="kpi.trend"></t>%
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="charts-section mb-4" t-if="state.dashboardData.charts">
                    <div class="row g-4">
                        <!-- Status Distribution Chart -->
                        <div class="col-lg-6">
                            <div class="card chart-card h-100">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">
                                        <i class="fa fa-chart-pie text-primary me-2"></i>
                                        Status Distribution
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container" style="height: 300px;">
                                        <canvas id="statusChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Timeline Chart -->
                        <div class="col-lg-6">
                            <div class="card chart-card h-100">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">
                                        <i class="fa fa-chart-line text-success me-2"></i>
                                        Progress Timeline
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container" style="height: 300px;">
                                        <canvas id="timelineChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions Section -->
                <div class="quick-actions-section mb-4">
                    <div class="row g-4">
                        <!-- Recent Activities -->
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">
                                        <i class="fa fa-clock text-info me-2"></i>
                                        Recent Activities
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div t-if="!state.dashboardData.recent_activities || state.dashboardData.recent_activities.length === 0" 
                                         class="text-center text-muted py-4">
                                        <i class="fa fa-inbox fa-2x mb-3"></i>
                                        <p>No recent activities</p>
                                    </div>
                                    <div t-else="" class="activities-list">
                                        <div t-foreach="state.dashboardData.recent_activities" t-as="activity" t-key="activity.id" 
                                             class="activity-item d-flex align-items-start py-3 border-bottom">
                                            <div class="activity-icon me-3">
                                                <i t-att-class="'fa ' + activity.icon + ' text-' + activity.type"></i>
                                            </div>
                                            <div class="activity-content flex-grow-1">
                                                <p class="activity-message mb-1" t-esc="activity.message"></p>
                                                <small class="text-muted" t-esc="activity.date"></small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Alerts/Notifications -->
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">
                                        <i class="fa fa-bell text-warning me-2"></i>
                                        Notifications
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div t-if="!state.dashboardData.notifications || state.dashboardData.notifications.length === 0" 
                                         class="text-center text-muted py-4">
                                        <i class="fa fa-check-circle fa-2x mb-3"></i>
                                        <p>All caught up!</p>
                                    </div>
                                    <div t-else="" class="notifications-list">
                                        <div t-foreach="state.dashboardData.notifications" t-as="notification" t-key="notification.id" 
                                             class="notification-item py-2 border-bottom">
                                            <div t-att-class="'alert alert-' + notification.type + ' alert-sm mb-0'">
                                                <strong t-esc="notification.title"></strong>
                                                <p class="mb-0" t-esc="notification.message"></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="dashboard-footer text-center">
                    <small class="text-muted">
                        Last updated: <span t-esc="state.dashboardData.last_updated or 'Just now'"></span>
                        | TechPal Internship Management System
                    </small>
                </div>
            </div>
        </div>
    </t>
</templates>