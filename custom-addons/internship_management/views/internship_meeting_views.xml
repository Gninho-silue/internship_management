<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- ================================= -->
        <!-- MEETING MANAGEMENT VIEWS -->
        <!-- ================================= -->

        <!-- Meeting Tree View -->
        <record id="view_internship_meeting_tree" model="ir.ui.view">
            <field name="name">internship.meeting.tree</field>
            <field name="model">internship.meeting</field>
            <field name="arch" type="xml">
                <tree string="Meetings"
                      decoration-info="state=='draft'"
                      decoration-warning="state=='confirmed'"
                      decoration-success="state=='completed'"
                      decoration-primary="state=='in_progress'"
                      decoration-muted="state=='cancelled'"
                      create="true"
                      multi_edit="1">

                    <!-- Meeting Information -->
                    <field name="name"/>
                    <field name="stage_id"/>
                    <field name="meeting_type" widget="badge"/>
                    <field name="meeting_type_modality" widget="badge"/>
                    <field name="date"/>
                    <field name="duration"/>
                    <field name="organizer_id"/>
                    <field name="state" widget="badge"/>

                    <!-- Actions -->
                    <button name="action_confirm" type="object" icon="fa-check"
                            title="Confirm Meeting" class="btn-link"
                            invisible="state != 'draft'" aria-label="Confirm"/>
                    <button name="action_start" type="object" icon="fa-play"
                            title="Start Meeting" class="btn-link"
                            invisible="state != 'confirmed'" aria-label="Start"/>
                    <button name="action_complete" type="object" icon="fa-stop"
                            title="Complete Meeting" class="btn-link"
                            invisible="state != 'in_progress'" aria-label="Complete"/>
                    <button name="action_cancel" type="object" icon="fa-times"
                            title="Cancel Meeting" class="btn-link"
                            invisible="state in ['cancelled', 'completed']" aria-label="Cancel"/>
                </tree>
            </field>
        </record>

        <!-- Meeting Kanban View -->
        <record id="view_internship_meeting_kanban" model="ir.ui.view">
            <field name="name">internship.meeting.kanban</field>
            <field name="model">internship.meeting</field>
            <field name="arch" type="xml">
                <kanban default_group_by="state" class="o_kanban_small_column">
                    <field name="name"/>
                    <field name="stage_id"/>
                    <field name="meeting_type"/>
                    <field name="meeting_type_modality"/>
                    <field name="date"/>
                    <field name="duration"/>
                    <field name="organizer_id"/>
                    <field name="state"/>
                    <field name="is_today"/>
                    <field name="is_past"/>
                    <field name="location"/>
                    <field name="participant_ids"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_card oe_kanban_global_click #{record.state.raw_value == 'completed' ? 'oe_kanban_color_success' : record.state.raw_value == 'in_progress' ? 'oe_kanban_color_primary' : record.state.raw_value == 'confirmed' ? 'oe_kanban_color_info' : record.state.raw_value == 'cancelled' ? 'oe_kanban_color_muted' : ''}">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                        </strong>
                                        <div class="o_kanban_record_subtitle">
                                            <span class="badge badge-pill" t-attf-style="background-color: #{record.meeting_type.raw_value == 'kickoff' ? '#28a745' : record.meeting_type.raw_value == 'follow_up' ? '#17a2b8' : record.meeting_type.raw_value == 'defense' ? '#dc3545' : record.meeting_type.raw_value == 'evaluation' ? '#ffc107' : '#6c757d'};">
                                                <field name="meeting_type"/>
                                            </span>
                                            <span class="badge badge-secondary" t-if="record.meeting_type_modality.raw_value == 'virtual'">
                                                <i class="fa fa-video-camera"/> Virtual
                                            </span>
                                            <span class="badge badge-secondary" t-if="record.meeting_type_modality.raw_value == 'physical'">
                                                <i class="fa fa-building"/> Physical
                                            </span>
                                        </div>
                                    </div>
                                    <div class="o_kanban_manage_button_section">
                                        <a class="o_kanban_manage_toggle_button" href="#">
                                            <i class="fa fa-ellipsis-v" role="img" aria-label="Manage" title="Manage"/>
                                        </a>
                                    </div>
                                </div>
                                <div class="o_kanban_record_body">
                                    <div class="row">
                                        <div class="col-12">
                                            <i class="fa fa-calendar" title="Date"/> <field name="date"/>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <i class="fa fa-clock-o" title="Duration"/> <field name="duration"/>h
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <i class="fa fa-user" title="Organizer"/> <field name="organizer_id"/>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <i class="fa fa-building" title="Internship"/> <field name="stage_id"/>
                                        </div>
                                    </div>
                                    <div class="row mt-2" t-if="record.location.raw_value">
                                        <div class="col-12">
                                            <i class="fa fa-map-marker" title="Location"/> <field name="location"/>
                                        </div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col-12">
                                            <i class="fa fa-users" title="Participants"/> <field name="participant_ids" widget="many2many_tags"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <span class="badge badge-pill" t-attf-style="background-color: #{record.state.raw_value == 'draft' ? '#6c757d' : record.state.raw_value == 'confirmed' ? '#ffc107' : record.state.raw_value == 'in_progress' ? '#17a2b8' : record.state.raw_value == 'completed' ? '#28a745' : '#6c757d'};">
                                            <field name="state"/>
                                        </span>
                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <button name="action_confirm" type="object" icon="fa-check"
                                                title="Confirm" class="btn-link btn-sm"
                                                invisible="state != 'draft'"/>
                                        <button name="action_start" type="object" icon="fa-play"
                                                title="Start" class="btn-link btn-sm"
                                                invisible="state != 'confirmed'"/>
                                        <button name="action_complete" type="object" icon="fa-stop"
                                                title="Complete" class="btn-link btn-sm"
                                                invisible="state != 'in_progress'"/>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Meeting Calendar View -->
        <record id="view_internship_meeting_calendar" model="ir.ui.view">
            <field name="name">internship.meeting.calendar</field>
            <field name="model">internship.meeting</field>
            <field name="arch" type="xml">
                <calendar string="Meeting Calendar"
                          date_start="date"
                          date_stop="end_date"
                          color="meeting_type"
                          create="1"
                          mode="month">
                    <field name="name"/>
                    <field name="meeting_type"/>
                    <field name="stage_id"/>
                    <field name="organizer_id"/>
                    <field name="location"/>
                    <field name="meeting_type_modality"/>
                </calendar>
            </field>
        </record>

        <!-- Meeting Search View -->
        <record id="view_internship_meeting_search" model="ir.ui.view">
            <field name="name">internship.meeting.search</field>
            <field name="model">internship.meeting</field>
            <field name="arch" type="xml">
                <search string="Search Meetings">
                    <!-- Search Fields -->
                    <field name="name"/>
                    <field name="stage_id"/>
                    <field name="organizer_id"/>
                    <field name="location"/>

                    <!-- Filters -->
                    <filter string="My Meetings" name="my_meetings"
                            domain="[('participant_ids', 'in', uid)]"/>
                    <filter string="Organized by Me" name="organized_by_me"
                            domain="[('organizer_id', '=', uid)]"/>
                    <filter string="Draft" name="draft" domain="[('state', '=', 'draft')]"/>
                    <filter string="Confirmed" name="confirmed" domain="[('state', '=', 'confirmed')]"/>
                    <filter string="In Progress" name="in_progress" domain="[('state', '=', 'in_progress')]"/>
                    <filter string="Completed" name="completed" domain="[('state', '=', 'completed')]"/>
                    <filter string="Cancelled" name="cancelled" domain="[('state', '=', 'cancelled')]"/>

                    <!-- Type Filters -->
                    <separator/>
                    <filter string="Kickoff Meetings" name="kickoff" domain="[('meeting_type', '=', 'kickoff')]"/>
                    <filter string="Follow-up Meetings" name="follow_up" domain="[('meeting_type', '=', 'follow_up')]"/>
                    <filter string="Defense Meetings" name="defense" domain="[('meeting_type', '=', 'defense')]"/>
                    <filter string="Evaluation Meetings" name="evaluation" domain="[('meeting_type', '=', 'evaluation')]"/>

                    <!-- Meeting Modality Filters -->
                    <separator/>
                    <filter string="Virtual Meetings" name="virtual" domain="[('meeting_type_modality', '=', 'virtual')]"/>
                    <filter string="Physical Meetings" name="physical" domain="[('meeting_type_modality', '=', 'physical')]"/>

                    <!-- Date Filters -->
                    <separator/>
                    <filter string="Today" name="today" domain="[('date', '=', context_today().strftime('%Y-%m-%d'))]"/>
                    <filter string="This Week" name="this_week" domain="[('date', '>=', (context_today() - datetime.timedelta(days=7)).strftime('%Y-%m-%d'))]"/>
                    <filter string="This Month" name="this_month" domain="[('date', '>=', context_today().strftime('%Y-%m-01'))]"/>
                    
                    <!-- Group By -->
                    <group expand="0" string="Group By">
                        <filter string="Status" name="group_state" context="{'group_by': 'state'}"/>
                        <filter string="Meeting Type" name="group_meeting_type" context="{'group_by': 'meeting_type'}"/>
                        <filter string="Organizer" name="group_organizer" context="{'group_by': 'organizer_id'}"/>
                        <filter string="Date" name="group_date" context="{'group_by': 'date:day'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Meeting Form View -->
        <record id="view_internship_meeting_form" model="ir.ui.view">
            <field name="name">internship.meeting.form</field>
            <field name="model">internship.meeting</field>
            <field name="arch" type="xml">
                <form string="Meeting Management" class="o_meeting_form">
                    <header>
                        <!-- Action Buttons -->
                        <button name="action_confirm" string="Confirm Meeting" type="object"
                                class="oe_highlight" icon="fa-check"
                                invisible="state != 'draft'"/>
                        <button name="action_start" string="Start Meeting" type="object"
                                class="oe_highlight" icon="fa-play"
                                invisible="state != 'confirmed'"/>
                        <button name="action_complete" string="Complete Meeting" type="object"
                                class="oe_highlight" icon="fa-stop"
                                invisible="state != 'in_progress'"/>
                        <button name="action_cancel" string="Cancel Meeting" type="object"
                                class="btn-danger" icon="fa-times"
                                invisible="state in ['cancelled', 'completed']"/>

                        <!-- Communication Actions -->
                        <button name="action_open_meeting_communications" string="Meeting Communications" type="object"
                                class="btn-info" icon="fa-comments"/>

                        <!-- Statusbar -->
                        <field name="state" widget="statusbar"
                               statusbar_visible="draft,confirmed,in_progress,completed"/>
                    </header>

                    <sheet>
                        <!-- Title -->
                        <div class="oe_title">
                            <h1>
                                <field name="name" placeholder="Meeting title..."/>
                            </h1>
                        </div>

                        <!-- Main Information -->
                        <group>
                            <group string="Basic Information">
                                <field name="stage_id" options="{'no_create': True}"/>
                                <field name="organizer_id" readonly="1"/>
                                <field name="meeting_type" widget="radio" options="{'horizontal': True}"/>
                            </group>
                            <group string="Schedule">
                                <field name="date"/>
                                <field name="duration"/>
                                <field name="end_date" readonly="1"/>
                                <field name="location"/>
                            </group>
                        </group>

                        <!-- Meeting Modality -->
                        <group string="Meeting Details">
                            <field name="meeting_type_modality" widget="radio" options="{'horizontal': True}"/>
                            <field name="meeting_url" invisible="meeting_type_modality != 'virtual'"/>
                        </group>

                        <!-- Participants -->
                        <group string="Participants">
                            <field name="participant_ids" widget="many2many_tags" options="{'no_create': True}"/>
                        </group>


                        <!-- Alerts -->
                        <div class="alert alert-info" role="alert"
                             invisible="state != 'draft'">
                            <i class="fa fa-info-circle"/>
                            This meeting is in draft mode. Confirm it to notify participants.
                        </div>

                        <div class="alert alert-warning" role="alert"
                             invisible="state != 'confirmed'">
                            <i class="fa fa-clock-o"/>
                            This meeting is confirmed and ready to start.
                        </div>

                        <div class="alert alert-primary" role="alert"
                             invisible="state != 'in_progress'">
                            <i class="fa fa-play"/>
                            This meeting is currently in progress.
                        </div>

                        <div class="alert alert-success" role="alert"
                             invisible="state != 'completed'">
                            <i class="fa fa-check-circle"/>
                            This meeting has been completed successfully.
                        </div>

                        <!-- Content -->
                        <notebook>
                            <page string="Agenda" name="agenda">
                                <field name="agenda" nolabel="1"
                                       placeholder="Detail the meeting agenda..."
                                       class="oe_form_field_html"/>
                            </page>

                            <page string="Summary" name="summary">
                                <field name="summary" nolabel="1"
                                       placeholder="Write the meeting summary..."
                                       class="oe_form_field_html"/>
                            </page>

                            <page string="Next Actions" name="actions">
                                <field name="next_actions" nolabel="1"
                                       placeholder="List the follow-up actions..."
                                       class="oe_form_field_html"/>
                            </page>

                            <page string="Decisions" name="decisions">
                                <field name="decisions" nolabel="1"
                                       placeholder="Record key decisions made..."
                                       class="oe_form_field_html"/>
                            </page>

                            <page string="Related Documents" name="documents">
                                <field name="document_ids">
                                    <tree>
                                        <field name="name"/>
                                        <field name="document_type"/>
                                        <field name="date_upload"/>
                                        <field name="state" widget="badge"/>
                                    </tree>
                                </field>
                            </page>

                            <!-- Meeting Communications Page -->
                            <page string="Communications" name="communications">
                                <group string="Meeting Communications">
                                    <field name="communication_ids" widget="one2many">
                                        <tree>
                                            <field name="subject"/>
                                            <field name="communication_type"/>
                                            <field name="sender_id"/>
                                            <field name="priority" widget="priority"/>
                                            <field name="state"/>
                                            <field name="create_date"/>
                                        </tree>
                                    </field>
                                </group>
                            </page>
                        </notebook>
                    </sheet>

                    <!-- Chatter -->
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                    </div>
                </form>
            </field>
        </record>

        <!-- ================================= -->
        <!-- ACTIONS -->
        <!-- ================================= -->

        <!-- Main action for meetings -->
        <record id="action_internship_meeting_list" model="ir.actions.act_window">
            <field name="name">Meetings</field>
            <field name="res_model">internship.meeting</field>
            <field name="view_mode">calendar,kanban,tree,form</field>
            <field name="context">{}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Schedule your first meeting!
                </p>
                <p>
                    Plan and manage follow-up meetings and internship defenses.
                </p>
            </field>
        </record>

        <!-- Action for my meetings -->
        <record id="action_internship_meeting_my" model="ir.actions.act_window">
            <field name="name">My Meetings</field>
            <field name="res_model">internship.meeting</field>
            <field name="view_mode">calendar,kanban,tree,form</field>
            <field name="domain">[('participant_ids', 'in', uid)]</field>
            <field name="context">{'search_default_my_meetings': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No meetings scheduled!
                </p>
                <p>
                    You will be notified when new meetings are scheduled.
                </p>
            </field>
        </record>

        <!-- Action for meetings I organize -->
        <record id="action_internship_meeting_organized" model="ir.actions.act_window">
            <field name="name">Meetings I Organize</field>
            <field name="res_model">internship.meeting</field>
            <field name="view_mode">calendar,kanban,tree,form</field>
            <field name="domain">[('organizer_id', '=', uid)]</field>
            <field name="context">{'search_default_organized_by_me': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    You haven't organized any meetings yet!
                </p>
                <p>
                    Create meetings to schedule follow-ups and defenses.
                </p>
            </field>
        </record>

    </data>
</odoo>