<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
    ================================================================
    NOTE SUR LES BONNES PRATIQUES APPLIQUÉES ICI :
    1. web.external_layout : Chaque rapport est enveloppé dans ce layout
       standard d'Odoo. Il ajoute automatiquement l'en-tête (avec le logo
       de votre entreprise) et le pied de page, garantissant un aspect
       professionnel et cohérent sur tous les documents.
    2. t-field : Nous utilisons t-field au lieu de t-esc pour tous les
       champs du modèle. Odoo se charge ainsi de formater correctement
       les données (dates, nombres, champs sélection, etc.) selon la
       langue de l'utilisateur.
    3. Accès direct : Plus besoin de passer par un dictionnaire 'data'.
       On accède directement aux informations via l'objet 'stage'
       (ex: stage.student_id.name), ce qui est plus simple et plus lisible.
    ================================================================
    -->

    <!-- =================================================== -->
    <!-- TEMPLATE 1 : ATTESTATION DE STAGE                   -->
    <!-- =================================================== -->
    <template id="attestation_report_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="stage">
                <t t-call="web.external_layout">
                    <div class="page">
                        <div class="oe_structure"/>
                        <div style="text-align: center; margin-top: 40px; margin-bottom: 30px;">
                            <h1 style="font-size: 24px; font-weight: bold; color: #2c3e50; letter-spacing: 1px; margin-bottom: 10px;">
                                ATTESTATION DE FIN DE STAGE
                            </h1>
                            <div style="width: 100px; height: 3px; background: linear-gradient(to right, #3498db, #2980b9); margin: 0 auto;"></div>
                        </div>

                        <div style="margin: 40px auto; padding: 30px; max-width: 800px; border: 2px solid #e8e8e8; border-radius: 8px; background: #fafafa; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <p style="text-align: center; font-size: 16px; color: #555; margin-bottom: 30px; font-style: italic;">
                                Nous certifions par la présente que :
                            </p>

                            <div t-foreach="stage.student_ids" t-as="student" style="margin-bottom: 30px; padding: 20px; background: white; border-radius: 6px; border-left: 4px solid #3498db;">
                                <h3 style="text-align: center; color: #2c3e50; font-size: 20px; font-weight: bold; margin: 15px 0;">
                                    <span t-field="student.full_name"/>
                            </h3>
                                <p style="text-align: center; color: #7f8c8d; font-size: 14px; margin-top: 10px;">
                                    Numéro d'étudiant : <strong><span t-field="student.student_id_number"/></strong>
                                </p>
                            </div>

                            <p style="line-height: 1.8; font-size: 15px; color: #34495e; text-align: justify; margin: 25px 0;">
                                <t t-if="len(stage.student_ids) == 1">
                                a effectué avec succès un stage au sein de notre entreprise,
                                </t>
                                <t t-if="len(stage.student_ids) > 1">
                                    ont effectué avec succès un stage au sein de notre entreprise,
                                </t>
                                <strong style="color: #2c3e50;"><span t-field="stage.company_id.name"/></strong>,
                                du <strong><span t-field="stage.start_date" t-options="{'widget': 'date'}"/></strong>
                                au <strong><span t-field="stage.end_date" t-options="{'widget': 'date'}"/></strong>.
                            </p>

                            <div style="background: #ecf0f1; padding: 15px; border-radius: 6px; margin: 25px 0;">
                                <p style="margin: 0; font-size: 14px; color: #555;">
                                    <strong style="color: #2c3e50;">Intitulé du projet :</strong>
                                    <em style="color: #7f8c8d;"><span t-field="stage.title"/></em>
                                </p>
                            </div>

                            <div style="text-align: center; margin: 30px 0;">
                                <div style="display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px 40px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                    <div style="color: white; font-size: 14px; margin-bottom: 8px;">Note Finale</div>
                                    <div style="color: white; font-size: 32px; font-weight: bold;">
                                        <span t-field="stage.final_grade"/> / 20
                                    </div>
                                    <div style="color: rgba(255,255,255,0.9); font-size: 12px; margin-top: 8px;">
                                        Appréciation : <strong t-esc="data[stage.id]['performance']"/>
                                    </div>
                                </div>
                            </div>

                            <p style="text-align: right; margin-top: 40px; color: #7f8c8d; font-size: 14px;">
                                Fait à <span t-field="company.city"/>, le <span t-esc="datetime.datetime.now()" t-options="{'widget': 'date'}"/>.
                            </p>

                            <div style="display: flex; justify-content: space-around; margin-top: 60px; padding-top: 40px; border-top: 2px solid #e8e8e8;">
                                <div style="text-align: center; flex: 1;">
                                    <p style="font-weight: bold; color: #2c3e50; margin-bottom: 10px; font-size: 14px;">L'Encadrant</p>
                                    <p style="color: #7f8c8d; font-size: 13px; margin-bottom: 15px;"><span t-field="stage.supervisor_id.name"/></p>
                                    <img t-if="stage.supervisor_signature"
                                         t-att-src="image_data_uri(stage.supervisor_signature)"
                                         style="max-height: 80px; max-width: 150px;"/>
                                </div>
                                <div style="text-align: center; flex: 1;">
                                    <p style="font-weight: bold; color: #2c3e50; margin-bottom: 10px; font-size: 14px;">Direction des Ressources Humaines</p>
                                    <p style="color: #7f8c8d; font-size: 13px; margin-bottom: 15px;"><span t-field="company.name"/></p>
                                    <img t-if="stage.jury_signature" 
                                         t-att-src="image_data_uri(stage.jury_signature)"
                                         style="max-height: 80px; max-width: 150px;"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <!-- =================================================== -->
    <!-- TEMPLATE 2 : CONVENTION DE STAGE                    -->
    <!-- =================================================== -->
    <template id="convention_report_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="stage">
                <t t-call="web.external_layout">
                    <div class="page">
                        <div class="oe_structure"/>
                        <div style="text-align: center; margin-top: 30px; margin-bottom: 25px;">
                            <h1 style="font-size: 24px; font-weight: bold; color: #2c3e50; letter-spacing: 1px; margin-bottom: 10px;">
                                CONVENTION DE STAGE
                            </h1>
                            <div style="width: 100px; height: 3px; background: linear-gradient(to right, #3498db, #2980b9); margin: 0 auto;"></div>
                            <p style="margin-top: 15px; color: #7f8c8d; font-size: 14px;">
                                Référence : <strong style="color: #2c3e50;"><span t-field="stage.reference_number"/></strong>
                            </p>
                        </div>

                        <div style="max-width: 900px; margin: 0 auto; padding: 20px;">
                            <h3 style="color: #2c3e50; font-size: 18px; font-weight: bold; margin-top: 30px; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #3498db;">
                                Article 1 : Les Parties Contractantes
                            </h3>
                            <p style="line-height: 1.8; color: #34495e; margin-bottom: 15px;">
                                La présente convention est établie entre :
                            </p>
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 6px; border-left: 4px solid #3498db; margin: 15px 0;">
                                <p style="margin: 10px 0; color: #2c3e50;">
                                <strong>L'Entreprise :</strong>
                                <span t-field="stage.company_id.name"/>, représentée par
                                <span t-field="stage.supervisor_id.name"/>
                                    <t t-if="stage.supervisor_id.position">
                                        (<span t-field="stage.supervisor_id.position"/>)
                                    </t>
                                </p>
                            </div>
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 6px; border-left: 4px solid #3498db; margin: 15px 0;">
                                <p style="margin: 10px 0; color: #2c3e50;">
                                    <strong t-if="len(stage.student_ids) == 1">Le Stagiaire :</strong>
                                    <strong t-if="len(stage.student_ids) > 1">Les Stagiaires :</strong>
                                </p>
                                <ul style="list-style: none; padding-left: 0; margin: 10px 0;">
                                    <li t-foreach="stage.student_ids" t-as="student" style="margin: 8px 0; padding: 8px; background: white; border-radius: 4px;">
                                        <span t-field="student.full_name"/>
                                        <t t-if="student.institution">
                                            , étudiant à <span t-field="student.institution"/>
                                        </t>
                                        <t t-if="student.student_id_number">
                                            (N° étudiant : <span t-field="student.student_id_number"/>)
                                        </t>
                            </li>
                        </ul>
                            </div>

                            <h3 style="color: #2c3e50; font-size: 18px; font-weight: bold; margin-top: 30px; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #3498db;">
                                Article 2 : Objet du Stage
                            </h3>
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 6px; margin: 15px 0;">
                                <p style="line-height: 1.8; color: #34495e; margin-bottom: 10px;">
                            Le stage a pour objet le projet intitulé :
                                    <strong style="color: #2c3e50;"><span t-field="stage.title"/></strong>.
                        </p>
                                <p t-if="stage.project_description" style="line-height: 1.8; color: #34495e; margin-top: 15px;">
                                    <strong style="color: #2c3e50;">Description :</strong>
                            <span t-field="stage.project_description"/>
                        </p>
                            </div>

                            <h3 style="color: #2c3e50; font-size: 18px; font-weight: bold; margin-top: 30px; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #3498db;">
                                Article 3 : Durée et Horaires
                            </h3>
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 6px; margin: 15px 0;">
                                <p style="line-height: 1.8; color: #34495e; margin-bottom: 10px;">
                            Le stage se déroulera du
                                    <strong><span t-field="stage.start_date" t-options="{'widget': 'date'}"/></strong>
                                    au <strong><span t-field="stage.end_date" t-options="{'widget': 'date'}"/></strong>.
                        </p>
                                <p style="line-height: 1.8; color: #34495e; margin-top: 10px;">
                                    La durée hebdomadaire de présence <t t-if="len(stage.student_ids) == 1">du stagiaire</t><t t-if="len(stage.student_ids) > 1">des stagiaires</t> est fixée à 40 heures,
                            selon les horaires en vigueur dans l'entreprise.
                        </p>
                            </div>

                            <h3 style="color: #2c3e50; font-size: 18px; font-weight: bold; margin-top: 30px; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #3498db;">
                                Article 4 : Engagements
                            </h3>
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 6px; margin: 15px 0;">
                                <p style="line-height: 1.8; color: #34495e;">
                                    <t t-if="len(stage.student_ids) == 1">Le stagiaire</t>
                                    <t t-if="len(stage.student_ids) > 1">Les stagiaires</t>
                                    s'engage<t t-if="len(stage.student_ids) == 1">nt</t><t t-if="len(stage.student_ids) > 1">nt</t> à respecter le règlement intérieur de l'entreprise et les règles de
                            confidentialité. L'entreprise s'engage à fournir les moyens nécessaires à la bonne
                            réalisation du stage.
                        </p>
                            </div>

                            <div style="display: flex; justify-content: space-around; margin-top: 80px; padding-top: 40px; border-top: 2px solid #e8e8e8;">
                                <div style="text-align: center; flex: 1;">
                                    <p style="font-weight: bold; color: #2c3e50; margin-bottom: 10px; font-size: 14px;">Signature de l'Encadrant</p>
                                    <p style="color: #7f8c8d; font-size: 13px; margin-bottom: 15px;"><span t-field="stage.supervisor_id.name"/></p>
                                    <img t-if="stage.supervisor_signature"
                                         t-att-src="image_data_uri(stage.supervisor_signature)" 
                                         style="max-height: 80px; max-width: 150px;"/>
                                </div>
                                <div style="text-align: center; flex: 1;">
                                    <p style="font-weight: bold; color: #2c3e50; margin-bottom: 10px; font-size: 14px;">
                                        Signature<t t-if="len(stage.student_ids) > 1">s</t> <t t-if="len(stage.student_ids) == 1">du Stagiaire</t><t t-if="len(stage.student_ids) > 1">des Stagiaires</t>
                                    </p>
                                    <div t-foreach="stage.student_ids" t-as="student" style="margin-bottom: 15px;">
                                        <p style="color: #7f8c8d; font-size: 13px; margin-bottom: 8px;"><span t-field="student.full_name"/></p>
                                        <img t-if="stage.student_signature" 
                                             t-att-src="image_data_uri(stage.student_signature)"
                                             style="max-height: 60px; max-width: 120px;"/>
                                    </div>
                                </div>
                                <div style="text-align: center; flex: 1;">
                                    <p style="font-weight: bold; color: #2c3e50; margin-bottom: 10px; font-size: 14px;">Cachet de l'Entreprise</p>
                            </div>
                            </div>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>


    <!-- =================================================== -->
    <!-- TEMPLATE 3 : PROCÈS-VERBAL DE SOUTENANCE            -->
    <!-- =================================================== -->
    <template id="defense_report_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="stage">
                <t t-call="web.external_layout">
                    <div class="page">
                        <div class="oe_structure"/>
                        <div style="text-align: center; margin-top: 30px; margin-bottom: 25px;">
                            <h1 style="font-size: 24px; font-weight: bold; color: #2c3e50; letter-spacing: 1px; margin-bottom: 10px;">
                                PROCÈS-VERBAL DE SOUTENANCE
                            </h1>
                            <div style="width: 100px; height: 3px; background: linear-gradient(to right, #3498db, #2980b9); margin: 0 auto;"></div>
                        </div>

                        <div style="max-width: 900px; margin: 0 auto; padding: 20px;">
                            <p style="line-height: 1.8; color: #34495e; font-size: 15px; margin: 30px 0; text-align: justify;">
                                Ce document atteste que <t t-if="len(stage.student_ids) == 1">la soutenance de fin de stage de</t><t t-if="len(stage.student_ids) > 1">les soutenances de fin de stage de</t>
                                <t t-set="student_names" t-value="', '.join([s.full_name for s in stage.student_ids])"/>
                                <strong style="color: #2c3e50;" t-esc="student_names"/>
                                <t t-if="len(stage.student_ids) == 1">s'est tenue</t><t t-if="len(stage.student_ids) > 1">se sont tenues</t> le
                                <strong style="color: #2c3e50;">
                                <span t-field="stage.defense_date" t-options="{'widget': 'datetime'}"/>
                                </strong>.
                            </p>

                            <table style="width: 100%; border-collapse: collapse; margin: 30px 0; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                <tr style="background: #f8f9fa;">
                                    <th style="width: 30%; padding: 15px; text-align: left; border: 1px solid #dee2e6; color: #2c3e50; font-weight: bold;">Intitulé du Stage</th>
                                    <td style="padding: 15px; border: 1px solid #dee2e6; color: #34495e;">
                                    <span t-field="stage.title"/>
                                </td>
                            </tr>
                            <tr>
                                    <th style="padding: 15px; text-align: left; border: 1px solid #dee2e6; background: #f8f9fa; color: #2c3e50; font-weight: bold;">
                                        <t t-if="len(stage.student_ids) == 1">Étudiant</t>
                                        <t t-if="len(stage.student_ids) > 1">Étudiants</t>
                                    </th>
                                    <td style="padding: 15px; border: 1px solid #dee2e6; color: #34495e;">
                                        <ul style="list-style: none; padding: 0; margin: 0;">
                                            <li t-foreach="stage.student_ids" t-as="student" style="margin: 5px 0; padding: 5px 0;">
                                                <span t-field="student.full_name"/>
                                                <t t-if="student.student_id_number">
                                                    (ID: <span t-field="student.student_id_number"/>)
                                                </t>
                                            </li>
                                        </ul>
                                </td>
                            </tr>
                            <tr>
                                    <th style="padding: 15px; text-align: left; border: 1px solid #dee2e6; background: #f8f9fa; color: #2c3e50; font-weight: bold;">Encadrant Professionnel</th>
                                    <td style="padding: 15px; border: 1px solid #dee2e6; color: #34495e;">
                                    <span t-field="stage.supervisor_id.name"/>
                                </td>
                            </tr>
                        </table>

                            <h3 style="color: #2c3e50; font-size: 18px; font-weight: bold; margin-top: 30px; margin-bottom: 20px; padding-bottom: 8px; border-bottom: 2px solid #3498db;">
                                Résultats de l'évaluation
                            </h3>
                            <div style="display: flex; gap: 20px; margin: 30px 0;">
                                <div style="flex: 1; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; padding: 25px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                    <h4 style="color: white; font-size: 14px; font-weight: bold; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px;">Note de Soutenance</h4>
                                    <div style="color: white; font-size: 48px; font-weight: bold;">
                                        <span t-field="stage.defense_grade"/> / 20
                                    </div>
                                </div>
                                <div style="flex: 1; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 10px; padding: 25px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                    <h4 style="color: white; font-size: 14px; font-weight: bold; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px;">Note Finale de Stage</h4>
                                    <div style="color: white; font-size: 48px; font-weight: bold;">
                                        <span t-field="stage.final_grade"/> / 20
                                </div>
                            </div>
                        </div>

                            <div style="display: flex; justify-content: space-around; margin-top: 80px; padding-top: 40px; border-top: 2px solid #e8e8e8;">
                                <div style="text-align: center; flex: 1;">
                                    <p style="font-weight: bold; color: #2c3e50; margin-bottom: 10px; font-size: 14px;">Signature de l'Encadrant</p>
                                <img t-if="stage.supervisor_signature"
                                         t-att-src="image_data_uri(stage.supervisor_signature)" 
                                         style="max-height: 80px; max-width: 150px;"/>
                                </div>
                                <div style="text-align: center; flex: 1;">
                                    <p style="font-weight: bold; color: #2c3e50; margin-bottom: 10px; font-size: 14px;">
                                        Signature<t t-if="len(stage.student_ids) > 1">s</t> <t t-if="len(stage.student_ids) == 1">de l'Étudiant</t><t t-if="len(stage.student_ids) > 1">des Étudiants</t>
                                    </p>
                                    <div t-foreach="stage.student_ids" t-as="student" style="margin-bottom: 15px;">
                                        <p style="color: #7f8c8d; font-size: 13px; margin-bottom: 8px;"><span t-field="student.full_name"/></p>
                                        <img t-if="stage.student_signature" 
                                             t-att-src="image_data_uri(stage.student_signature)"
                                             style="max-height: 60px; max-width: 120px;"/>
                                    </div>
                            </div>
                                <div style="text-align: center; flex: 1;">
                                    <p style="font-weight: bold; color: #2c3e50; margin-bottom: 10px; font-size: 14px;">Président du Jury</p>
                                    <img t-if="stage.jury_signature" 
                                         t-att-src="image_data_uri(stage.jury_signature)"
                                         style="max-height: 80px; max-width: 150px;"/>
                            </div>
                            </div>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <!-- =================================================== -->
    <!-- TEMPLATE 4 : RAPPORT D'ÉVALUATION                   -->
    <!-- =================================================== -->
    <template id="evaluation_report_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="stage">
                <t t-call="web.external_layout">
                    <div class="page">
                        <div class="oe_structure"/>
                        <div style="text-align: center; margin-top: 30px; margin-bottom: 25px;">
                            <h1 style="font-size: 24px; font-weight: bold; color: #2c3e50; letter-spacing: 1px; margin-bottom: 10px;">
                                Rapport d'Évaluation de Stage
                            </h1>
                            <div style="width: 100px; height: 3px; background: linear-gradient(to right, #3498db, #2980b9); margin: 0 auto;"></div>
                        </div>

                        <div style="max-width: 900px; margin: 0 auto; padding: 20px;">
                            <table style="width: 100%; border-collapse: collapse; margin: 30px 0; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                <tr>
                                    <th style="width: 25%; padding: 15px; text-align: left; border: 1px solid #dee2e6; background: #f8f9fa; color: #2c3e50; font-weight: bold;">
                                        <t t-if="len(stage.student_ids) == 1">Étudiant :</t>
                                        <t t-if="len(stage.student_ids) > 1">Étudiants :</t>
                                    </th>
                                    <td style="padding: 15px; border: 1px solid #dee2e6; color: #34495e;">
                                        <ul style="list-style: none; padding: 0; margin: 0;">
                                            <li t-foreach="stage.student_ids" t-as="student" style="margin: 5px 0; padding: 5px 0;">
                                                <span t-field="student.full_name"/>
                                                <t t-if="student.student_id_number">
                                                    (N°: <span t-field="student.student_id_number"/>)
                                                </t>
                                            </li>
                                        </ul>
                                </td>
                            </tr>
                            <tr>
                                    <th style="padding: 15px; text-align: left; border: 1px solid #dee2e6; background: #f8f9fa; color: #2c3e50; font-weight: bold;">Projet :</th>
                                    <td style="padding: 15px; border: 1px solid #dee2e6; color: #34495e;">
                                    <span t-field="stage.title"/>
                                </td>
                            </tr>
                            <tr>
                                    <th style="padding: 15px; text-align: left; border: 1px solid #dee2e6; background: #f8f9fa; color: #2c3e50; font-weight: bold;">Encadrant :</th>
                                    <td style="padding: 15px; border: 1px solid #dee2e6; color: #34495e;">
                                    <span t-field="stage.supervisor_id.name"/>
                                </td>
                            </tr>
                            <tr>
                                    <th style="padding: 15px; text-align: left; border: 1px solid #dee2e6; background: #f8f9fa; color: #2c3e50; font-weight: bold;">Période :</th>
                                    <td style="padding: 15px; border: 1px solid #dee2e6; color: #34495e;">
                                        Du <strong><span t-field="stage.start_date" t-options="{'widget': 'date'}"/></strong>
                                        au <strong><span t-field="stage.end_date" t-options="{'widget': 'date'}"/></strong>
                                </td>
                            </tr>
                        </table>

                            <h3 style="color: #2c3e50; font-size: 18px; font-weight: bold; margin-top: 30px; margin-bottom: 20px; padding-bottom: 8px; border-bottom: 2px solid #3498db;">
                                Évaluation Quantitative
                                </h3>
                            <div style="display: flex; gap: 20px; margin: 30px 0;">
                                <div style="flex: 1; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; padding: 25px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                    <h4 style="color: white; font-size: 14px; font-weight: bold; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px;">Note Projet</h4>
                                    <div style="color: white; font-size: 48px; font-weight: bold;">
                                        <span t-field="stage.final_grade"/> / 20
                                    </div>
                                </div>
                                <div style="flex: 1; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 10px; padding: 25px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                    <h4 style="color: white; font-size: 14px; font-weight: bold; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px;">Note Soutenance</h4>
                                    <div style="color: white; font-size: 48px; font-weight: bold;">
                                        <span t-field="stage.defense_grade"/> / 20
                                    </div>
                                </div>
                                <div style="flex: 1; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 10px; padding: 25px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                    <h4 style="color: white; font-size: 14px; font-weight: bold; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px;">Taux d'achèvement</h4>
                                    <div style="color: white; font-size: 48px; font-weight: bold;">
                                        <span t-field="stage.completion_percentage"/>%
                                    </div>
                            </div>
                            </div>

                            <div t-if="stage.evaluation_feedback" style="margin-top: 40px;">
                                <h3 style="color: #2c3e50; font-size: 18px; font-weight: bold; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #3498db;">
                                    Commentaires Qualitatifs de l'Encadrant
                                </h3>
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 6px; border-left: 4px solid #3498db; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                    <p t-field="stage.evaluation_feedback" style="line-height: 1.8; color: #34495e; margin: 0;"/>
                            </div>
                        </div>

                            <div style="display: flex; justify-content: space-around; margin-top: 80px; padding-top: 40px; border-top: 2px solid #e8e8e8;">
                                <div style="text-align: center; flex: 1;">
                                    <p style="font-weight: bold; color: #2c3e50; margin-bottom: 10px; font-size: 14px;">Approbation de l'Encadrant</p>
                                    <p style="color: #7f8c8d; font-size: 13px; margin-bottom: 15px;"><span t-field="stage.supervisor_id.name"/></p>
                                <img t-if="stage.supervisor_signature"
                                         t-att-src="image_data_uri(stage.supervisor_signature)" 
                                         style="max-height: 80px; max-width: 150px;"/>
                                </div>
                                <div style="text-align: center; flex: 1;">
                                    <p style="font-weight: bold; color: #2c3e50; margin-bottom: 10px; font-size: 14px;">Approbation RH</p>
                                    <p style="color: #7f8c8d; font-size: 13px; margin-bottom: 15px;"><span t-field="company.name"/></p>
                                    <img t-if="stage.jury_signature" 
                                         t-att-src="image_data_uri(stage.jury_signature)"
                                         style="max-height: 80px; max-width: 150px;"/>
                            </div>
                            </div>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <!-- =================================================== -->
    <!-- TEMPLATE 5 : RAPPORT DE SYNTHÈSE DE STAGE           -->
    <!-- =================================================== -->
    <template id="stage_report_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="stage">
                <t t-call="web.external_layout">
                    <div class="page">
                        <div class="oe_structure"/>
                        <div style="text-align: center; margin-top: 30px; margin-bottom: 25px;">
                            <h1 style="font-size: 24px; font-weight: bold; color: #2c3e50; letter-spacing: 1px; margin-bottom: 10px;">
                                Rapport de Synthèse de Stage
                            </h1>
                            <div style="width: 100px; height: 3px; background: linear-gradient(to right, #3498db, #2980b9); margin: 0 auto;"></div>
                            <p style="margin-top: 15px; color: #7f8c8d; font-size: 12px;">
                                Généré le : <strong><span t-esc="current_date" t-options="{'widget': 'date'}"/></strong>
                            </p>
                        </div>

                        <div style="max-width: 900px; margin: 0 auto; padding: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin: 30px 0; padding: 20px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                <div style="flex: 2;">
                                    <h2 style="color: #2c3e50; font-size: 20px; font-weight: bold; margin: 0;">
                                    <span t-field="stage.title"/>
                                    </h2>
                                    <p style="color: #7f8c8d; font-size: 13px; margin: 5px 0 0 0;">
                                        Réf. : <span t-field="stage.reference_number"/>
                                    </p>
                                </div>
                                <div style="flex: 1; text-align: right;">
                                    <div style="display: inline-block; padding: 8px 16px; background: #3498db; color: white; border-radius: 20px; font-size: 12px; font-weight: bold;">
                                        <span t-field="stage.state"/>
                                    </div>
                                </div>
                            </div>

                            <div style="display: flex; gap: 15px; margin: 30px 0;">
                                <div style="flex: 1; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; padding: 20px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                    <div style="color: white; font-size: 12px; font-weight: bold; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px;">Progrès</div>
                                    <div style="color: white; font-size: 36px; font-weight: bold;">
                                        <span t-field="stage.completion_percentage"/>%
                                    </div>
                                </div>
                                <div style="flex: 1; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 10px; padding: 20px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                    <div style="color: white; font-size: 12px; font-weight: bold; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px;">Note Finale</div>
                                    <div style="color: white; font-size: 36px; font-weight: bold;">
                                        <span t-field="stage.final_grade"/> / 20
                                    </div>
                                </div>
                                <div style="flex: 1; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 10px; padding: 20px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                    <div style="color: white; font-size: 12px; font-weight: bold; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px;">Durée</div>
                                    <div style="color: white; font-size: 36px; font-weight: bold;">
                                        <t t-if="stage.start_date and stage.end_date">
                                            <span t-esc="(stage.end_date - stage.start_date).days"/>
                                        </t>
                                        <t t-if="not (stage.start_date and stage.end_date)">-</t>
                                    </div>
                                    <div style="color: rgba(255,255,255,0.9); font-size: 11px; margin-top: 5px;">jours</div>
                                </div>
                                <div style="flex: 1; background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); border-radius: 10px; padding: 20px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                    <div style="color: white; font-size: 12px; font-weight: bold; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px;">Soutenance</div>
                                    <div style="color: white; font-size: 14px; font-weight: bold; margin-top: 10px;">
                                        <span t-field="stage.defense_status"/>
                                    </div>
                                </div>
                            </div>

                            <div style="display: flex; gap: 20px; margin: 30px 0;">
                                <div style="flex: 1; background: white; border: 1px solid #e8e8e8; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                    <h3 style="color: #2c3e50; font-size: 16px; font-weight: bold; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #3498db;">Informations Principales</h3>
                                    <ul style="list-style: none; padding: 0; margin: 0;">
                                        <li style="margin: 12px 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                                            <strong style="color: #2c3e50;">Étudiant<t t-if="len(stage.student_ids) > 1">s</t> :</strong>
                                            <ul style="list-style: none; padding-left: 0; margin: 5px 0 0 0;">
                                                <li t-foreach="stage.student_ids" t-as="student" style="margin: 5px 0; color: #34495e;">
                                                    <span t-field="student.full_name"/>
                                                    <t t-if="student.student_id_number">
                                                        (N°: <span t-field="student.student_id_number"/>)
                                                    </t>
                                                </li>
                                            </ul>
                                        </li>
                                        <li style="margin: 12px 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                                            <strong style="color: #2c3e50;">Encadrant :</strong>
                                            <span style="color: #34495e;"><span t-field="stage.supervisor_id.name"/></span>
                                        </li>
                                        <li style="margin: 12px 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                                            <strong style="color: #2c3e50;">Entreprise :</strong>
                                            <span style="color: #34495e;"><span t-field="stage.company_id.name"/></span>
                                        </li>
                                    </ul>
                                </div>
                                <div style="flex: 1; background: white; border: 1px solid #e8e8e8; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                    <h3 style="color: #2c3e50; font-size: 16px; font-weight: bold; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #3498db;">Détails du Stage</h3>
                                    <ul style="list-style: none; padding: 0; margin: 0;">
                                        <li style="margin: 12px 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                                            <strong style="color: #2c3e50;">Début :</strong>
                                            <span style="color: #34495e;"><span t-field="stage.start_date" t-options="{'widget': 'date'}"/></span>
                                        </li>
                                        <li style="margin: 12px 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                                            <strong style="color: #2c3e50;">Fin :</strong>
                                            <span style="color: #34495e;"><span t-field="stage.end_date" t-options="{'widget': 'date'}"/></span>
                                        </li>
                                        <li style="margin: 12px 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                                            <strong style="color: #2c3e50;">Type :</strong>
                                            <span style="color: #34495e;"><span t-field="stage.internship_type"/></span>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <div t-if="stage.project_description" style="margin-top: 30px; background: white; border: 1px solid #e8e8e8; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                <h3 style="color: #2c3e50; font-size: 18px; font-weight: bold; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #3498db;">
                                    Description du Projet
                                </h3>
                                <p t-field="stage.project_description" style="line-height: 1.8; color: #34495e; margin: 0;"/>
                            </div>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <!-- =================================================== -->
    <!-- TEMPLATES INDIVIDUELS PAR ÉTUDIANT                 -->
    <!-- =================================================== -->

    <!-- Attestation Individuelle -->
    <template id="attestation_student">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="student">
                <t t-set="stage" t-value="stage_map.get(student.id)"/>
                <t t-if="stage">
                    <t t-call="web.external_layout">
                        <div class="page">
                            <div class="oe_structure"/>
                            <div style="text-align: center; margin-top: 40px; margin-bottom: 30px;">
                                <h1 style="font-size: 24px; font-weight: bold; color: #2c3e50; letter-spacing: 1px; margin-bottom: 10px;">
                                    ATTESTATION DE FIN DE STAGE
                                </h1>
                                <div style="width: 100px; height: 3px; background: linear-gradient(to right, #3498db, #2980b9); margin: 0 auto;"></div>
                            </div>

                            <div style="margin: 40px auto; padding: 30px; max-width: 800px; border: 2px solid #e8e8e8; border-radius: 8px; background: #fafafa; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                <p style="text-align: center; font-size: 16px; color: #555; margin-bottom: 30px; font-style: italic;">
                                    Nous certifions par la présente que :
                                </p>

                                <div style="margin-bottom: 30px; padding: 20px; background: white; border-radius: 6px; border-left: 4px solid #3498db;">
                                    <h3 style="text-align: center; color: #2c3e50; font-size: 20px; font-weight: bold; margin: 15px 0;">
                                        <span t-field="student.full_name"/>
                                    </h3>
                                    <p style="text-align: center; color: #7f8c8d; font-size: 14px; margin-top: 10px;">
                                        Numéro d'étudiant : <strong><span t-field="student.student_id_number"/></strong>
                                    </p>
                                </div>

                                <p style="line-height: 1.8; font-size: 15px; color: #34495e; text-align: justify; margin: 25px 0;">
                                    a effectué avec succès un stage au sein de notre entreprise,
                                    <strong style="color: #2c3e50;"><span t-field="stage.company_id.name"/></strong>,
                                    du <strong><span t-field="stage.start_date" t-options="{'widget': 'date'}"/></strong>
                                    au <strong><span t-field="stage.end_date" t-options="{'widget': 'date'}"/></strong>.
                                </p>

                                <div style="background: #ecf0f1; padding: 15px; border-radius: 6px; margin: 25px 0;">
                                    <p style="margin: 0; font-size: 14px; color: #555;">
                                        <strong style="color: #2c3e50;">Intitulé du projet :</strong>
                                        <em style="color: #7f8c8d;"><span t-field="stage.title"/></em>
                                    </p>
                                </div>

                                <div style="text-align: center; margin: 30px 0;">
                                    <div style="display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px 40px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                        <div style="color: white; font-size: 14px; margin-bottom: 8px;">Note Finale</div>
                                        <div style="color: white; font-size: 32px; font-weight: bold;">
                                            <span t-field="stage.final_grade"/> / 20
                                        </div>
                                        <div style="color: rgba(255,255,255,0.9); font-size: 12px; margin-top: 8px;">
                                            Appréciation : <strong t-esc="data[student.id]['performance']"/>
                                        </div>
                                    </div>
                                </div>

                                <p style="text-align: right; margin-top: 40px; color: #7f8c8d; font-size: 14px;">
                                    Fait à <span t-field="company.city"/>, le <span t-esc="datetime.datetime.now()" t-options="{'widget': 'date'}"/>.
                                </p>

                                <div style="display: flex; justify-content: space-around; margin-top: 60px; padding-top: 40px; border-top: 2px solid #e8e8e8;">
                                    <div style="text-align: center; flex: 1;">
                                        <p style="font-weight: bold; color: #2c3e50; margin-bottom: 10px; font-size: 14px;">L'Encadrant</p>
                                        <p style="color: #7f8c8d; font-size: 13px; margin-bottom: 15px;"><span t-field="stage.supervisor_id.name"/></p>
                                        <img t-if="stage.supervisor_signature"
                                             t-att-src="image_data_uri(stage.supervisor_signature)"
                                             style="max-height: 80px; max-width: 150px;"/>
                                    </div>
                                    <div style="text-align: center; flex: 1;">
                                        <p style="font-weight: bold; color: #2c3e50; margin-bottom: 10px; font-size: 14px;">Direction des Ressources Humaines</p>
                                        <p style="color: #7f8c8d; font-size: 13px; margin-bottom: 15px;"><span t-field="company.name"/></p>
                                        <img t-if="stage.jury_signature" 
                                             t-att-src="image_data_uri(stage.jury_signature)"
                                             style="max-height: 80px; max-width: 150px;"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </t>
            </t>
        </t>
    </template>

    <!-- Convention Individuelle -->
    <template id="convention_student">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="student">
                <t t-set="stage" t-value="stage_map.get(student.id)"/>
                <t t-if="stage">
                    <t t-call="web.external_layout">
                        <div class="page">
                            <div class="oe_structure"/>
                            <div style="text-align: center; margin-top: 30px; margin-bottom: 25px;">
                                <h1 style="font-size: 24px; font-weight: bold; color: #2c3e50; letter-spacing: 1px; margin-bottom: 10px;">
                                    CONVENTION DE STAGE
                                </h1>
                                <div style="width: 100px; height: 3px; background: linear-gradient(to right, #3498db, #2980b9); margin: 0 auto;"></div>
                                <p style="margin-top: 15px; color: #7f8c8d; font-size: 14px;">
                                    Référence : <strong style="color: #2c3e50;"><span t-field="stage.reference_number"/></strong>
                                </p>
                            </div>

                            <div style="max-width: 900px; margin: 0 auto; padding: 20px;">
                                <h3 style="color: #2c3e50; font-size: 18px; font-weight: bold; margin-top: 30px; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #3498db;">
                                    Article 1 : Les Parties Contractantes
                                </h3>
                                <p style="line-height: 1.8; color: #34495e; margin-bottom: 15px;">
                                    La présente convention est établie entre :
                                </p>
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 6px; border-left: 4px solid #3498db; margin: 15px 0;">
                                    <p style="margin: 10px 0; color: #2c3e50;">
                                        <strong>L'Entreprise :</strong>
                                        <span t-field="stage.company_id.name"/>, représentée par
                                        <span t-field="stage.supervisor_id.name"/>
                                        <t t-if="stage.supervisor_id.position">
                                            (<span t-field="stage.supervisor_id.position"/>)
                                        </t>
                                    </p>
                                </div>
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 6px; border-left: 4px solid #3498db; margin: 15px 0;">
                                    <p style="margin: 10px 0; color: #2c3e50;">
                                        <strong>Le Stagiaire :</strong>
                                        <span t-field="student.full_name"/>
                                        <t t-if="student.institution">
                                            , étudiant à <span t-field="student.institution"/>
                                        </t>
                                        <t t-if="student.student_id_number">
                                            (N° étudiant : <span t-field="student.student_id_number"/>)
                                        </t>
                                    </p>
                                </div>

                                <h3 style="color: #2c3e50; font-size: 18px; font-weight: bold; margin-top: 30px; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #3498db;">
                                    Article 2 : Objet du Stage
                                </h3>
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 6px; margin: 15px 0;">
                                    <p style="line-height: 1.8; color: #34495e; margin-bottom: 10px;">
                                        Le stage a pour objet le projet intitulé :
                                        <strong style="color: #2c3e50;"><span t-field="stage.title"/></strong>.
                                    </p>
                                    <p t-if="stage.project_description" style="line-height: 1.8; color: #34495e; margin-top: 15px;">
                                        <strong style="color: #2c3e50;">Description :</strong>
                                        <span t-field="stage.project_description"/>
                                    </p>
                                </div>

                                <h3 style="color: #2c3e50; font-size: 18px; font-weight: bold; margin-top: 30px; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #3498db;">
                                    Article 3 : Durée et Horaires
                                </h3>
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 6px; margin: 15px 0;">
                                    <p style="line-height: 1.8; color: #34495e; margin-bottom: 10px;">
                                        Le stage se déroulera du
                                        <strong><span t-field="stage.start_date" t-options="{'widget': 'date'}"/></strong>
                                        au <strong><span t-field="stage.end_date" t-options="{'widget': 'date'}"/></strong>.
                                    </p>
                                    <p style="line-height: 1.8; color: #34495e; margin-top: 10px;">
                                        La durée hebdomadaire de présence du stagiaire est fixée à 40 heures,
                                        selon les horaires en vigueur dans l'entreprise.
                                    </p>
                                </div>

                                <h3 style="color: #2c3e50; font-size: 18px; font-weight: bold; margin-top: 30px; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #3498db;">
                                    Article 4 : Engagements
                                </h3>
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 6px; margin: 15px 0;">
                                    <p style="line-height: 1.8; color: #34495e;">
                                        Le stagiaire s'engage à respecter le règlement intérieur de l'entreprise et les règles de
                                        confidentialité. L'entreprise s'engage à fournir les moyens nécessaires à la bonne
                                        réalisation du stage.
                                    </p>
                                </div>

                                <div style="display: flex; justify-content: space-around; margin-top: 80px; padding-top: 40px; border-top: 2px solid #e8e8e8;">
                                    <div style="text-align: center; flex: 1;">
                                        <p style="font-weight: bold; color: #2c3e50; margin-bottom: 10px; font-size: 14px;">Signature de l'Encadrant</p>
                                        <p style="color: #7f8c8d; font-size: 13px; margin-bottom: 15px;"><span t-field="stage.supervisor_id.name"/></p>
                                        <img t-if="stage.supervisor_signature"
                                             t-att-src="image_data_uri(stage.supervisor_signature)" 
                                             style="max-height: 80px; max-width: 150px;"/>
                                    </div>
                                    <div style="text-align: center; flex: 1;">
                                        <p style="font-weight: bold; color: #2c3e50; margin-bottom: 10px; font-size: 14px;">Signature du Stagiaire</p>
                                        <p style="color: #7f8c8d; font-size: 13px; margin-bottom: 15px;"><span t-field="student.full_name"/></p>
                                        <img t-if="stage.student_signature" 
                                             t-att-src="image_data_uri(stage.student_signature)"
                                             style="max-height: 80px; max-width: 150px;"/>
                                    </div>
                                    <div style="text-align: center; flex: 1;">
                                        <p style="font-weight: bold; color: #2c3e50; margin-bottom: 10px; font-size: 14px;">Cachet de l'Entreprise</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </t>
            </t>
        </t>
    </template>

    <!-- Procès-Verbal Individuel -->
    <template id="defense_student">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="student">
                <t t-set="stage" t-value="stage_map.get(student.id)"/>
                <t t-if="stage">
                    <t t-call="web.external_layout">
                        <div class="page">
                            <div class="oe_structure"/>
                            <div style="text-align: center; margin-top: 30px; margin-bottom: 25px;">
                                <h1 style="font-size: 24px; font-weight: bold; color: #2c3e50; letter-spacing: 1px; margin-bottom: 10px;">
                                    PROCÈS-VERBAL DE SOUTENANCE
                                </h1>
                                <div style="width: 100px; height: 3px; background: linear-gradient(to right, #3498db, #2980b9); margin: 0 auto;"></div>
                            </div>

                            <div style="max-width: 900px; margin: 0 auto; padding: 20px;">
                                <p style="line-height: 1.8; color: #34495e; font-size: 15px; margin: 30px 0; text-align: justify;">
                                    Ce document atteste que la soutenance de fin de stage de
                                    <strong style="color: #2c3e50;"><span t-field="student.full_name"/></strong>
                                    s'est tenue le
                                    <strong style="color: #2c3e50;">
                                        <span t-field="stage.defense_date" t-options="{'widget': 'datetime'}"/>
                                    </strong>.
                                </p>

                                <table style="width: 100%; border-collapse: collapse; margin: 30px 0; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                    <tr style="background: #f8f9fa;">
                                        <th style="width: 30%; padding: 15px; text-align: left; border: 1px solid #dee2e6; color: #2c3e50; font-weight: bold;">Intitulé du Stage</th>
                                        <td style="padding: 15px; border: 1px solid #dee2e6; color: #34495e;">
                                            <span t-field="stage.title"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th style="padding: 15px; text-align: left; border: 1px solid #dee2e6; background: #f8f9fa; color: #2c3e50; font-weight: bold;">Étudiant</th>
                                        <td style="padding: 15px; border: 1px solid #dee2e6; color: #34495e;">
                                            <span t-field="student.full_name"/>
                                            <t t-if="student.student_id_number">
                                                (ID: <span t-field="student.student_id_number"/>)
                                            </t>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th style="padding: 15px; text-align: left; border: 1px solid #dee2e6; background: #f8f9fa; color: #2c3e50; font-weight: bold;">Encadrant Professionnel</th>
                                        <td style="padding: 15px; border: 1px solid #dee2e6; color: #34495e;">
                                            <span t-field="stage.supervisor_id.name"/>
                                        </td>
                                    </tr>
                                </table>

                                <h3 style="color: #2c3e50; font-size: 18px; font-weight: bold; margin-top: 30px; margin-bottom: 20px; padding-bottom: 8px; border-bottom: 2px solid #3498db;">
                                    Résultats de l'évaluation
                                </h3>
                                <div style="display: flex; gap: 20px; margin: 30px 0;">
                                    <div style="flex: 1; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; padding: 25px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                        <h4 style="color: white; font-size: 14px; font-weight: bold; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px;">Note de Soutenance</h4>
                                        <div style="color: white; font-size: 48px; font-weight: bold;">
                                            <span t-field="stage.defense_grade"/> / 20
                                        </div>
                                    </div>
                                    <div style="flex: 1; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 10px; padding: 25px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                        <h4 style="color: white; font-size: 14px; font-weight: bold; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px;">Note Finale de Stage</h4>
                                        <div style="color: white; font-size: 48px; font-weight: bold;">
                                            <span t-field="stage.final_grade"/> / 20
                                        </div>
                                    </div>
                                </div>

                                <div style="display: flex; justify-content: space-around; margin-top: 80px; padding-top: 40px; border-top: 2px solid #e8e8e8;">
                                    <div style="text-align: center; flex: 1;">
                                        <p style="font-weight: bold; color: #2c3e50; margin-bottom: 10px; font-size: 14px;">Signature de l'Encadrant</p>
                                        <img t-if="stage.supervisor_signature"
                                             t-att-src="image_data_uri(stage.supervisor_signature)" 
                                             style="max-height: 80px; max-width: 150px;"/>
                                    </div>
                                    <div style="text-align: center; flex: 1;">
                                        <p style="font-weight: bold; color: #2c3e50; margin-bottom: 10px; font-size: 14px;">Signature de l'Étudiant</p>
                                        <p style="color: #7f8c8d; font-size: 13px; margin-bottom: 8px;"><span t-field="student.full_name"/></p>
                                        <img t-if="stage.student_signature" 
                                             t-att-src="image_data_uri(stage.student_signature)"
                                             style="max-height: 80px; max-width: 150px;"/>
                                    </div>
                                    <div style="text-align: center; flex: 1;">
                                        <p style="font-weight: bold; color: #2c3e50; margin-bottom: 10px; font-size: 14px;">Président du Jury</p>
                                        <img t-if="stage.jury_signature" 
                                             t-att-src="image_data_uri(stage.jury_signature)"
                                             style="max-height: 80px; max-width: 150px;"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </t>
            </t>
        </t>
    </template>

    <!-- Rapport d'Évaluation Individuel -->
    <template id="evaluation_student">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="student">
                <t t-set="stage" t-value="stage_map.get(student.id)"/>
                <t t-if="stage">
                    <t t-call="web.external_layout">
                        <div class="page">
                            <div class="oe_structure"/>
                            <div style="text-align: center; margin-top: 30px; margin-bottom: 25px;">
                                <h1 style="font-size: 24px; font-weight: bold; color: #2c3e50; letter-spacing: 1px; margin-bottom: 10px;">
                                    Rapport d'Évaluation de Stage
                                </h1>
                                <div style="width: 100px; height: 3px; background: linear-gradient(to right, #3498db, #2980b9); margin: 0 auto;"></div>
                            </div>

                            <div style="max-width: 900px; margin: 0 auto; padding: 20px;">
                                <table style="width: 100%; border-collapse: collapse; margin: 30px 0; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                    <tr>
                                        <th style="width: 25%; padding: 15px; text-align: left; border: 1px solid #dee2e6; background: #f8f9fa; color: #2c3e50; font-weight: bold;">Étudiant :</th>
                                        <td style="padding: 15px; border: 1px solid #dee2e6; color: #34495e;">
                                            <span t-field="student.full_name"/>
                                            <t t-if="student.student_id_number">
                                                (N°: <span t-field="student.student_id_number"/>)
                                            </t>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th style="padding: 15px; text-align: left; border: 1px solid #dee2e6; background: #f8f9fa; color: #2c3e50; font-weight: bold;">Projet :</th>
                                        <td style="padding: 15px; border: 1px solid #dee2e6; color: #34495e;">
                                            <span t-field="stage.title"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th style="padding: 15px; text-align: left; border: 1px solid #dee2e6; background: #f8f9fa; color: #2c3e50; font-weight: bold;">Encadrant :</th>
                                        <td style="padding: 15px; border: 1px solid #dee2e6; color: #34495e;">
                                            <span t-field="stage.supervisor_id.name"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th style="padding: 15px; text-align: left; border: 1px solid #dee2e6; background: #f8f9fa; color: #2c3e50; font-weight: bold;">Période :</th>
                                        <td style="padding: 15px; border: 1px solid #dee2e6; color: #34495e;">
                                            Du <strong><span t-field="stage.start_date" t-options="{'widget': 'date'}"/></strong>
                                            au <strong><span t-field="stage.end_date" t-options="{'widget': 'date'}"/></strong>
                                        </td>
                                    </tr>
                                </table>

                                <h3 style="color: #2c3e50; font-size: 18px; font-weight: bold; margin-top: 30px; margin-bottom: 20px; padding-bottom: 8px; border-bottom: 2px solid #3498db;">
                                    Évaluation Quantitative
                                </h3>
                                <div style="display: flex; gap: 20px; margin: 30px 0;">
                                    <div style="flex: 1; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; padding: 25px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                        <h4 style="color: white; font-size: 14px; font-weight: bold; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px;">Note Projet</h4>
                                        <div style="color: white; font-size: 48px; font-weight: bold;">
                                            <span t-field="stage.final_grade"/> / 20
                                        </div>
                                    </div>
                                    <div style="flex: 1; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 10px; padding: 25px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                        <h4 style="color: white; font-size: 14px; font-weight: bold; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px;">Note Soutenance</h4>
                                        <div style="color: white; font-size: 48px; font-weight: bold;">
                                            <span t-field="stage.defense_grade"/> / 20
                                        </div>
                                    </div>
                                    <div style="flex: 1; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 10px; padding: 25px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                        <h4 style="color: white; font-size: 14px; font-weight: bold; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px;">Taux d'achèvement</h4>
                                        <div style="color: white; font-size: 48px; font-weight: bold;">
                                            <span t-field="stage.completion_percentage"/>%
                                        </div>
                                    </div>
                                </div>

                                <div t-if="stage.evaluation_feedback" style="margin-top: 40px;">
                                    <h3 style="color: #2c3e50; font-size: 18px; font-weight: bold; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #3498db;">
                                        Commentaires Qualitatifs de l'Encadrant
                                    </h3>
                                    <div style="background: #f8f9fa; padding: 20px; border-radius: 6px; border-left: 4px solid #3498db; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <p t-field="stage.evaluation_feedback" style="line-height: 1.8; color: #34495e; margin: 0;"/>
                            </div>
                        </div>

                                <div style="display: flex; justify-content: space-around; margin-top: 80px; padding-top: 40px; border-top: 2px solid #e8e8e8;">
                                    <div style="text-align: center; flex: 1;">
                                        <p style="font-weight: bold; color: #2c3e50; margin-bottom: 10px; font-size: 14px;">Approbation de l'Encadrant</p>
                                        <p style="color: #7f8c8d; font-size: 13px; margin-bottom: 15px;"><span t-field="stage.supervisor_id.name"/></p>
                                        <img t-if="stage.supervisor_signature"
                                             t-att-src="image_data_uri(stage.supervisor_signature)" 
                                             style="max-height: 80px; max-width: 150px;"/>
                                    </div>
                                    <div style="text-align: center; flex: 1;">
                                        <p style="font-weight: bold; color: #2c3e50; margin-bottom: 10px; font-size: 14px;">Approbation RH</p>
                                        <p style="color: #7f8c8d; font-size: 13px; margin-bottom: 15px;"><span t-field="company.name"/></p>
                                        <img t-if="stage.jury_signature" 
                                             t-att-src="image_data_uri(stage.jury_signature)"
                                             style="max-height: 80px; max-width: 150px;"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </t>
            </t>
        </t>
    </template>
</odoo>